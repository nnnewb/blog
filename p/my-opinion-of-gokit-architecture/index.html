<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="å‰è¨€ è¿™æ˜¯çœ‹äº† Go kit: the road ahead ä¹‹åï¼Œå¯¹ go kit è¿™å¥—æŠ½è±¡çš„ä¸€äº›æƒ³æ³•ã€‚ä¸»è¦æ˜¯å…³äº endpoint æ˜¯å¦æœ‰å¿…è¦ã€generic ä¼šå¦‚ä½•å½±å“ go kit çš„æ¶æ„ã€go kit çš„ä»£ç ç”Ÿæˆè¿™äº›é—®é¢˜ã€‚
endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨ æˆ‘çš„çœ‹æ³•æ˜¯éœ€è¦ã€‚åŸå› ä¸‹é¢åˆ†æã€‚
ä¸€ä¸ªæ²¡æœ‰é¢å¤–åŠŸèƒ½çš„ Endpoint å…¶å®æ˜¯èµ·åˆ°äº†æŠŠè¯·æ±‚ç±»å‹é€‚é…åˆ° Go å‡½æ•°ç­¾åçš„ä½œç”¨ã€‚stringsvc å®ç°å¦‚ä¸‹ã€‚
import ( &amp;#34;context&amp;#34; &amp;#34;github.com/go-kit/kit/endpoint&amp;#34; ) func makeUppercaseEndpoint(svc StringService) endpoint.Endpoint { return func(_ context.Context, request interface{}) (interface{}, error) { req := request.(uppercaseRequest) v, err := svc.Uppercase(req.S) if err != nil { return uppercaseResponse{v, err.Error()}, nil } return uppercaseResponse{v, &amp;#34;&amp;#34;}, nil } } func makeCountEndpoint(svc StringService) endpoint."><title>gokit æ¶æ„ä¹‹æˆ‘è§</title>
<link rel=canonical href=https://nnnewb.github.io/blog/p/my-opinion-of-gokit-architecture/>
<link rel=stylesheet href=/blog/scss/style.min.css><meta property="og:title" content="gokit æ¶æ„ä¹‹æˆ‘è§">
<meta property="og:description" content="å‰è¨€ è¿™æ˜¯çœ‹äº† Go kit: the road ahead ä¹‹åï¼Œå¯¹ go kit è¿™å¥—æŠ½è±¡çš„ä¸€äº›æƒ³æ³•ã€‚ä¸»è¦æ˜¯å…³äº endpoint æ˜¯å¦æœ‰å¿…è¦ã€generic ä¼šå¦‚ä½•å½±å“ go kit çš„æ¶æ„ã€go kit çš„ä»£ç ç”Ÿæˆè¿™äº›é—®é¢˜ã€‚
endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨ æˆ‘çš„çœ‹æ³•æ˜¯éœ€è¦ã€‚åŸå› ä¸‹é¢åˆ†æã€‚
ä¸€ä¸ªæ²¡æœ‰é¢å¤–åŠŸèƒ½çš„ Endpoint å…¶å®æ˜¯èµ·åˆ°äº†æŠŠè¯·æ±‚ç±»å‹é€‚é…åˆ° Go å‡½æ•°ç­¾åçš„ä½œç”¨ã€‚stringsvc å®ç°å¦‚ä¸‹ã€‚
import ( &amp;#34;context&amp;#34; &amp;#34;github.com/go-kit/kit/endpoint&amp;#34; ) func makeUppercaseEndpoint(svc StringService) endpoint.Endpoint { return func(_ context.Context, request interface{}) (interface{}, error) { req := request.(uppercaseRequest) v, err := svc.Uppercase(req.S) if err != nil { return uppercaseResponse{v, err.Error()}, nil } return uppercaseResponse{v, &amp;#34;&amp;#34;}, nil } } func makeCountEndpoint(svc StringService) endpoint.">
<meta property="og:url" content="https://nnnewb.github.io/blog/p/my-opinion-of-gokit-architecture/">
<meta property="og:site_name" content="weakptr's ç¬”è®°">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="gokit"><meta property="article:tag" content="golang"><meta property="article:tag" content="å¾®æœåŠ¡"><meta property="article:published_time" content="2022-03-02T12:30:00+08:00"><meta property="article:modified_time" content="2022-03-02T12:30:00+08:00">
<meta name=twitter:title content="gokit æ¶æ„ä¹‹æˆ‘è§">
<meta name=twitter:description content="å‰è¨€ è¿™æ˜¯çœ‹äº† Go kit: the road ahead ä¹‹åï¼Œå¯¹ go kit è¿™å¥—æŠ½è±¡çš„ä¸€äº›æƒ³æ³•ã€‚ä¸»è¦æ˜¯å…³äº endpoint æ˜¯å¦æœ‰å¿…è¦ã€generic ä¼šå¦‚ä½•å½±å“ go kit çš„æ¶æ„ã€go kit çš„ä»£ç ç”Ÿæˆè¿™äº›é—®é¢˜ã€‚
endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨ æˆ‘çš„çœ‹æ³•æ˜¯éœ€è¦ã€‚åŸå› ä¸‹é¢åˆ†æã€‚
ä¸€ä¸ªæ²¡æœ‰é¢å¤–åŠŸèƒ½çš„ Endpoint å…¶å®æ˜¯èµ·åˆ°äº†æŠŠè¯·æ±‚ç±»å‹é€‚é…åˆ° Go å‡½æ•°ç­¾åçš„ä½œç”¨ã€‚stringsvc å®ç°å¦‚ä¸‹ã€‚
import ( &amp;#34;context&amp;#34; &amp;#34;github.com/go-kit/kit/endpoint&amp;#34; ) func makeUppercaseEndpoint(svc StringService) endpoint.Endpoint { return func(_ context.Context, request interface{}) (interface{}, error) { req := request.(uppercaseRequest) v, err := svc.Uppercase(req.S) if err != nil { return uppercaseResponse{v, err.Error()}, nil } return uppercaseResponse{v, &amp;#34;&amp;#34;}, nil } } func makeCountEndpoint(svc StringService) endpoint.">
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"dark")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/blog class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>è¿”å›</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/blog/categories/golang/>
golang
</a>
</header>
<h2 class=article-title>
<a href=/blog/p/my-opinion-of-gokit-architecture/>gokit æ¶æ„ä¹‹æˆ‘è§</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2022å¹´ 3æœˆ 2æ—¥</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
é˜…è¯»æ—¶é•¿: 2 åˆ†é’Ÿ
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=å‰è¨€>å‰è¨€</h2>
<p>è¿™æ˜¯çœ‹äº† <a class=link href=https://github.com/go-kit/kit/issues/843 target=_blank rel=noopener>Go kit: the road ahead</a> ä¹‹åï¼Œå¯¹ go kit è¿™å¥—æŠ½è±¡çš„ä¸€äº›æƒ³æ³•ã€‚ä¸»è¦æ˜¯å…³äº endpoint æ˜¯å¦æœ‰å¿…è¦ã€generic ä¼šå¦‚ä½•å½±å“ go kit çš„æ¶æ„ã€go kit çš„ä»£ç ç”Ÿæˆè¿™äº›é—®é¢˜ã€‚</p>
<h2 id=endpoint-æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨>endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨</h2>
<p>æˆ‘çš„çœ‹æ³•æ˜¯éœ€è¦ã€‚åŸå› ä¸‹é¢åˆ†æã€‚</p>
<p>ä¸€ä¸ªæ²¡æœ‰é¢å¤–åŠŸèƒ½çš„ Endpoint å…¶å®æ˜¯èµ·åˆ°äº†æŠŠè¯·æ±‚ç±»å‹é€‚é…åˆ° Go å‡½æ•°ç­¾åçš„ä½œç”¨ã€‚<a class=link href=http://gokit.io/examples/stringsvc.html#endpoints target=_blank rel=noopener>stringsvc</a> å®ç°å¦‚ä¸‹ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;context&#34;</span>
	<span class=s>&#34;github.com/go-kit/kit/endpoint&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>makeUppercaseEndpoint</span><span class=p>(</span><span class=nx>svc</span> <span class=nx>StringService</span><span class=p>)</span> <span class=nx>endpoint</span><span class=p>.</span><span class=nx>Endpoint</span> <span class=p>{</span>
	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>request</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
		<span class=nx>req</span> <span class=o>:=</span> <span class=nx>request</span><span class=p>.(</span><span class=nx>uppercaseRequest</span><span class=p>)</span>
		<span class=nx>v</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>svc</span><span class=p>.</span><span class=nf>Uppercase</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>S</span><span class=p>)</span>
		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
			<span class=k>return</span> <span class=nx>uppercaseResponse</span><span class=p>{</span><span class=nx>v</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()},</span> <span class=kc>nil</span>
		<span class=p>}</span>
		<span class=k>return</span> <span class=nx>uppercaseResponse</span><span class=p>{</span><span class=nx>v</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>},</span> <span class=kc>nil</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>makeCountEndpoint</span><span class=p>(</span><span class=nx>svc</span> <span class=nx>StringService</span><span class=p>)</span> <span class=nx>endpoint</span><span class=p>.</span><span class=nx>Endpoint</span> <span class=p>{</span>
	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>request</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
		<span class=nx>req</span> <span class=o>:=</span> <span class=nx>request</span><span class=p>.(</span><span class=nx>countRequest</span><span class=p>)</span>
		<span class=nx>v</span> <span class=o>:=</span> <span class=nx>svc</span><span class=p>.</span><span class=nf>Count</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>S</span><span class=p>)</span>
		<span class=k>return</span> <span class=nx>countResponse</span><span class=p>{</span><span class=nx>v</span><span class=p>},</span> <span class=kc>nil</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>å¯¹äºå†™è¿‡ rpcx æˆ–è€… gRPC çš„æœ‹å‹æ¥è¯´ï¼ŒEndpoint æ›´åƒæ˜¯ä¸ªè„±è£¤å­æ”¾å±çš„å°è£…ã€‚åªè¦æŠŠæ¥å£å‚æ•°çº¦å®šæˆ <code>func (ctx context.Context, req interface{}) (interface{}, error)</code> ä¸å°±å®Œäº†ï¼Ÿä¼ è¾“å±‚æ”¶åˆ°çš„è¯·æ±‚è§£ç æˆæœ¬åœ°æ•°æ®ç±»å‹ï¼Œç„¶åæŒ‰çº¦å®šä¼ å…¥ï¼Œå°±ä¸‡äº‹å¤§å‰äº†ã€‚</p>
<p>ç©ºå£æ— å‡­ï¼Œä¸å¦‚çœ‹çœ‹å¦‚æœä¸è¦ endpointï¼Œå®é™…ç¼–å†™çš„ä»£ç ä¼šå˜æˆä»€ä¹ˆæ ·ã€‚</p>
<p>åƒæ˜¯ go kit æä¾›çš„è¿™ç§å¸®åŠ©å‡½æ•°ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>uppercaseHandler</span> <span class=o>:=</span> <span class=nx>httptransport</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span>
    <span class=nf>makeUppercaseEndpoint</span><span class=p>(</span><span class=nx>svc</span><span class=p>),</span>
    <span class=nx>decodeUppercaseRequest</span><span class=p>,</span>
    <span class=nx>encodeResponse</span><span class=p>,</span>
<span class=p>)</span>

<span class=nx>countHandler</span> <span class=o>:=</span> <span class=nx>httptransport</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span>
    <span class=nf>makeCountEndpoint</span><span class=p>(</span><span class=nx>svc</span><span class=p>),</span>
    <span class=nx>decodeCountRequest</span><span class=p>,</span>
    <span class=nx>encodeResponse</span><span class=p>,</span>
<span class=p>)</span>
</code></pre></div><p>å¯èƒ½å°±ä¼šå˜æˆè¿™æ ·ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>uppercaseHandler</span> <span class=o>:=</span> <span class=nx>httptransport</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span>
    <span class=nx>svc</span><span class=p>.</span><span class=nx>Uppercase</span><span class=p>,</span>
    <span class=nx>decodeUppercaseRequest</span><span class=p>,</span>
    <span class=nx>encodeResponse</span><span class=p>,</span>
<span class=p>)</span>

<span class=nx>countHandler</span> <span class=o>:=</span> <span class=nx>httptransport</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span>
    <span class=nx>svc</span><span class=p>.</span><span class=nx>Count</span><span class=p>,</span>
    <span class=nx>decodeCountRequest</span><span class=p>,</span>
    <span class=nx>encodeResponse</span><span class=p>,</span>
<span class=p>)</span>
</code></pre></div><p>å½“ç„¶ï¼Œä¸ºäº†è®© Go è¯­è¨€çš„ç±»å‹ç³»ç»Ÿå¼€å¿ƒï¼Œè¿™é‡Œçš„ <code>svc.Uppercase</code> å’Œ <code>svc.Count</code> å¾—æ˜¯ä¸€æ ·çš„ç­¾åï¼Œæˆ–è€…ç”¨ <code>interface{}</code> åšå½¢å‚ï¼Œåˆæˆ–è€…è€ƒè™‘è¿˜æ²¡æœ‰å‘å¸ƒçš„æ³›å‹èƒ½ä¸èƒ½æ”¯æŒã€‚</p>
<p>çœ‹èµ·æ¥æ˜¯èˆ’æœäº†å¾ˆå¤šå¯¹å§ï¼ŸEndpoint æ²¡äº†ã€‚ä½†è¿˜æœ‰ä¸ªé—®é¢˜ï¼šä¸­é—´ä»¶ã€‚è¦æ€ä¹ˆå®ç°é€šç”¨çš„ä¸­é—´ä»¶ï¼Œåº”ç”¨åœ¨æ¯ä¸ªåŸæœ¬åº”è¯¥æ˜¯ Endpoint çš„åœ°æ–¹ï¼Ÿ</p>
<p>ä¾‹å¦‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿé‡Œå¾ˆå¸¸è§çš„åˆ†å¸ƒå¼è·Ÿè¸ªã€metricsæ”¶é›†ï¼Œæ— è®ºæœ€ç»ˆé‡‡ç”¨çš„æ˜¯ opentracingã€opencecusã€opentelemetry è¿˜æ˜¯ zipkinã€prometheusï¼Œè·Ÿè¸ªè°ƒç”¨é“¾è·¯æ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„å¯è§‚æµ‹æ€§è¦æ±‚ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥è¯´ç”¨ linkerd ä¸€ç±»çš„ service mesh è§£å†³æ–¹æ¡ˆï¼ˆè™½ç„¶æˆ‘è§‰å¾—ä¸èƒ½æ›¿ä»£ä¸Šé¢æåˆ°çš„è¿™äº›ä¸œè¥¿ï¼‰ï¼Œä½†ä¹Ÿåº”è¯¥æœ‰æ‰€è­¦æƒ•ï¼šæˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜æœ‰éœ€è¦åœ¨æ¯ä¸ªæ¥å£ä¸Šéƒ½æ‰§è¡Œã€å’Œä¼ è¾“å±‚æ— å…³çš„ä»£ç ï¼Ÿå¯¹ï¼Œè¿˜æœ‰èº«ä»½éªŒè¯å’Œé‰´æƒå·¥ä½œã€‚è¿˜æœ‰å—ï¼Ÿ</p>
<p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯è„±ç¦»äº† Endpoint å°±åˆ«æ— ä»–æ³•ï¼Œåªæ˜¯åœ¨éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘æƒ³æ€»è¿˜æ˜¯ä¼šæœ‰æ„æ— æ„æŠ½è±¡å‡ºä¸€ä¸ªç±»ä¼¼ endpoint çš„å±‚çº§â€”â€”å¯èƒ½éšè—åœ¨ service ä¸­é—´ä»¶é‡Œï¼Œä¹Ÿå¯èƒ½äº¤ç»™äº†ä¼ è¾“å±‚ã€‚å¯èƒ½å†™å¾—æ›´å¥½ï¼Œä¹Ÿå¯èƒ½åˆæ˜¯åœ¨å †å±å±±ã€‚ç»éªŒå‘Šè¯‰æˆ‘åœ¨ä¸€ä¸ªéœ€è¦é•¿æœŸæ”¯æŒçš„ç³»ç»Ÿé‡Œï¼Œäººæ˜¯é ä¸ä½çš„ï¼Œä½†è§„èŒƒå¯ä»¥ã€‚endpoint å¹¶æ²¡æœ‰ç‰ºç‰²å¤šå°‘ç¼–ç ä¸Šçš„è‡ªç”±åº¦ï¼Œä½†ä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†æ½œåœ¨çš„å †å±å¯èƒ½ï¼Œæˆ‘è§‰å¾—å®Œå…¨å¯ä»¥æ¥å—ã€‚</p>
<h2 id=generic-ä¼šå¦‚ä½•å½±å“-go-kit-æ¶æ„>generic ä¼šå¦‚ä½•å½±å“ go kit æ¶æ„</h2>
<p>æˆ‘ç›´è¯´ï¼ŒGo çš„æ³›å‹ï¼ˆbeta1ï¼‰å°±æ˜¯ä¸€æ³¡ç‹—å±ï¼Œæˆ‘å‘æ¥ä¸å–œæ¬¢ Go å›¢é˜Ÿçš„å“å‘³ï¼Œä» slice å’Œ interface{} æ³„éœ²è¯­è¨€çš„å®ç°ç»†èŠ‚åˆ°å…¶ä»–æ›´ç¦»è°±çš„ä¸œè¥¿ã€‚ä½†ç°åœ¨ Go æ³›å‹è¿˜æ²¡æœ‰æ­£å¼å…¬å¸ƒï¼ˆé¢„æœŸå°±åœ¨æœ¬æœˆï¼‰ï¼Œç°åœ¨æˆ‘ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯„è®ºçš„ã€‚</p>
<p>generic ä¼šå½±å“ go kit çš„æ¶æ„å—ï¼Ÿæˆ‘çš„çœ‹æ³•æ˜¯ä¸ä¼šã€‚æ³›å‹ä¹Ÿè®¸èƒ½æå¤§å¸®åŠ©å„ç§å®¹å™¨ç±»å‹ã€è¿­ä»£å™¨ä¹‹ç±»é¥±å— <code>interface{}</code> æŠ˜ç£¨çš„ç»„ä»¶ï¼Œä½†æ˜¯ go kit ç”¨å¾—ä¸Šæ³›å‹çš„åœ°æ–¹å…¶å®ä¸å¤šã€‚å°‘æ•°å¸¸è§çš„ <code>interface{}</code> åœºåˆï¼Œéƒ½æ˜¯åœ¨ä»ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªç±»å‹ï¼Œä»£ç ç¼–å†™è€…æ¸…æ¥šè‡ªå·±è¦å¤„ç†çš„ä¸¤ä¸ªç±»å‹ï¼Œä½† go kit ä¸çŸ¥é“ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>makeUppercaseEndpoint</span><span class=p>(</span><span class=nx>svc</span> <span class=nx>StringService</span><span class=p>)</span> <span class=nx>endpoint</span><span class=p>.</span><span class=nx>Endpoint</span> <span class=p>{</span>
	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>request</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
		<span class=nx>req</span> <span class=o>:=</span> <span class=nx>request</span><span class=p>.(</span><span class=nx>uppercaseRequest</span><span class=p>)</span>
		<span class=nx>v</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>svc</span><span class=p>.</span><span class=nf>Uppercase</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>S</span><span class=p>)</span>
		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
			<span class=k>return</span> <span class=nx>uppercaseResponse</span><span class=p>{</span><span class=nx>v</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()},</span> <span class=kc>nil</span>
		<span class=p>}</span>
		<span class=k>return</span> <span class=nx>uppercaseResponse</span><span class=p>{</span><span class=nx>v</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>},</span> <span class=kc>nil</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>è¿™éƒ¨åˆ†é€‚é…ä»£ç å¦‚æœæŠŠ <code>interface{}</code> æ›¿æ¢æˆå…·ä½“çš„ <code>uppercaseRequest</code> å’Œ <code>uppercaseResponse</code> çš„è¯ï¼Œå°±éœ€è¦ go kit æä¾›æ³›å‹å½¢å¼çš„ Endpoint æ¥å£äº†ï¼Œåƒæ˜¯è¿™æ ·ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>type</span> <span class=nx>Endpoint</span><span class=p>[</span><span class=nx>RequestType</span><span class=p>,</span><span class=nx>ResponseType</span><span class=p>]</span> <span class=p>=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>RequestType</span><span class=p>)</span> <span class=p>(</span><span class=nx>ResponseType</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</code></pre></div><p>ä¸Šé¢çš„ä»£ç æœ‰æ•ˆæ— æ•ˆå…ˆä¸è¯´ï¼Œæˆ‘è®°å¾—åœ¨ beta1 å°è¯•æ³›å‹çš„æ—¶å€™å‘ç° Go åœ¨æ¨æ–­ç±»å‹çš„æ—¶å€™å­˜åœ¨é—®é¢˜ï¼Œè¿™ä¸ª <code>RequestType</code> å’Œ <code>ResponseType</code> åœ¨å®é™…ç”¨çš„æ—¶å€™æ€•æ˜¯è¦å†™ä¸æ­¢ä¸€æ¬¡ã€‚åˆæ˜¯ Go ç‰¹è‰²çš„å•°å—¦ã€‚</p>
<p>å¯å³ä¾¿æ˜¯è¿™æ ·ææ€•è¿˜æœ‰é—®é¢˜ï¼Œå¦‚æœä¿®æ”¹äº† <code>Endpoint</code> çš„ç­¾åï¼Œé‚£ä¹ˆ <code>endpoint.Middleware</code> ææ€•ä¹Ÿè¦æ³›å‹åŒ–ï¼ŒåŸæ¥çš„æ‰€æœ‰ä¸­é—´ä»¶åº“ï¼Œ<code>trace</code>ã€<code>auth</code>ã€<code>metrics</code> å¯èƒ½ä¹Ÿå¾—åšæ³›å‹åŒ–æ”¹é€ ã€‚å¯¹ä¸€ä¸ªå·²ç»æ·±åº¦å¼€å‘è¿‡çš„ç³»ç»Ÿæ¥è¯´ï¼Œä¸ºäº†è¿™ä¸€ç‚¹ç±»å‹æ£€æŸ¥çš„å¥½å¤„ä»˜å‡ºå¦‚æ­¤ä»£ä»·ææ€•æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘çš„è§‚ç‚¹æ˜¯ Generic å¯èƒ½å¸¦æ¥å˜åŒ–ï¼Œä½†æ ¹æœ¬ä¸Šçš„å‡ ä¸ªæŠ½è±¡ä¸å¤§å¯èƒ½è·Ÿç€é‡æ„ï¼Œè¿™æ˜¯ç”± go kit æ€§è´¨å†³å®šçš„ã€‚</p>
<h2 id=go-kit-ä»£ç ç”Ÿæˆ>go kit ä»£ç ç”Ÿæˆ</h2>
<p>ä½†å‡¡è·Ÿç€ go kit å†™è¿‡ä¸€ä¸ª stringsvc çš„äººéƒ½ä¼šæ„Ÿè§‰åˆ° go kit æœ‰å¤šå°‘æ ·æ¿ä»£ç ï¼Œé€‚é…ä¼ è¾“å±‚éœ€è¦ç¼–å†™ encode/decodeï¼Œæœ¬åœ°ç»“æ„è½¬å‡½æ•°ç­¾åæ‰€éœ€çš„å‚æ•°åˆè¦ä¸€æ¬¡è½¬æ¢ï¼Œä¼ è¾“å±‚åè®®ç›‘å¬ã€æ³¨å†Œ<code>Handler</code>ã€å®¢æˆ·ç«¯è¿æ¥éƒ½è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œæ„é€ å’Œæ³¨å†Œ <code>Endpoint</code> å¤æ‚æ€§æ— éæ˜¯ä» <code>func main</code> ç§»åŠ¨åˆ° <code>transport</code> æˆ–è€…åè¿‡æ¥ï¼Œå°½ç®¡å¾ˆçƒ¦ï¼Œä½†åˆæ— æ³•æ ¹æœ¬ä¸Šæ¶ˆé™¤ã€‚</p>
<p>å¦‚æœæ˜¯ C++ ææ€•ä¼šæœ‰æ¨¡æ¿å…ƒç¼–ç¨‹å¤§ä½¬æ™’è‡ªå·±çš„ <code>template</code>ï¼Œä½† Go åŸºæœ¬æ²¡æœ‰ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„å…ƒç¼–ç¨‹èƒ½åŠ›ã€‚å”¯ä¸€æ¯”è¾ƒæ“…é•¿çš„å°±åªæœ‰ä¸ªä»£ç ç”Ÿæˆäº†ã€‚Go æä¾›çš„ <code>ast/parser</code> åŒ…å¾ˆèµï¼Œåˆ«çš„è¯­è¨€å°‘æœ‰æä¾›è¿™ä¹ˆæ–¹ä¾¿çš„æ¥å£çš„ã€‚</p>
<p>go kit çš„ä»£ç ç”Ÿæˆï¼Œä»ç›®å‰ä½“éªŒä¸­æ„Ÿå—æ¥çœ‹ï¼Œä¸»è¦æ˜¯éœ€è¦ä¸‹é¢çš„åŠŸèƒ½ï¼š</p>
<ol>
<li>ä» <code>interface</code> å®šä¹‰ç”Ÿæˆå¯¹åº”çš„ <code>makeEndpoint</code> å‡½æ•°å’Œè¯·æ±‚/å“åº”ç»“æ„ä½“ã€‚è¿™éƒ¨åˆ†ä»£ç åŸºæœ¬æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</li>
<li>ä» <code>interface</code> å®šä¹‰ç”Ÿæˆå¯¹åº”çš„ <code>transport</code> åŒ…ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©åè®®ã€‚ä¸»è¦è§£å†³ encode/decode æ‰‹å†™éº»çƒ¦çš„é—®é¢˜ã€‚</li>
<li>ä» <code>interface</code> å®šä¹‰ç”ŸæˆæœåŠ¡æ„é€ å’Œå¯åŠ¨ä»£ç ï¼Œåº”ç”¨å¯ä»¥è‡ªå·±æ„é€ ï¼Œä½† <code>endpoint</code> çš„æ„é€ å’Œ <code>middleware</code> çš„åº”ç”¨å°±å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚</li>
</ol>
<p>è¿™ä¸‰å¤„çš„æ ·æ¿ä»£ç æœ€å¤šï¼Œè€Œä¸”ä»£ç æœ¬èº«å¹¶ä¸ç‰¹åˆ«ï¼Œéƒ½æ˜¯ç®€å•åœ°å¯¹ç±»å‹è¿›è¡Œé€‚é…ï¼Œæ‰‹å†™å®Œå…¨æ˜¯æµªè´¹æ—¶é—´ï¼Œè¿˜ä¼šå¼•å…¥äººä¸ºçš„ä¸ç¡®å®šæ€§ï¼Œä¸å¦‚è®©æœºå™¨æå®šã€‚ç›®å‰è€ƒå¯Ÿè¿‡çš„ <a class=link href=https://github.com/GrantZheng/kit target=_blank rel=noopener>kit</a> å®ç°äº†å…¶ä¸­ä¸€å¤§éƒ¨åˆ†ï¼Œä½† transport æ”¯æŒå¤ªå°‘ï¼Œä¹Ÿæ²¡æœ‰ç”Ÿæˆæ³¨å†Œ endpoint çš„ä»£ç ï¼Œä¾ç„¶å­˜åœ¨å¾ˆå¤šæ‰‹å†™çš„æ ·æ¿ä»£ç ã€‚æˆ‘ç®€å•çœ‹äº†ä¸‹å®ç°ï¼Œç”¨ <a class=link href=https://github.com/dave/jennifer target=_blank rel=noopener>jennifer</a> ç”Ÿæˆä»£ç å¥½æ˜¯æŒºå¥½ï¼Œå°±æ˜¯ go ä»£ç æ˜¾å¾—æœ‰ç‚¹ä¹± &mldr;</p>
<p>æˆ‘å¯»æ€å¯¹ generator ç®€å•é‡æ„ä¸‹å®ç°å…³æ³¨ç‚¹åˆ†ç¦»çš„è¯ï¼Œè¿˜æ˜¯èƒ½æ»¡è¶³ä¸Šé¢æåˆ°çš„è¿™äº›ä¸œè¥¿çš„ã€‚æœ€å¥½çš„æƒ…å†µæ˜¯å®šä¹‰å¥½ interface ä¹‹åï¼Œç”Ÿæˆä»£ç ï¼Œç¼–å†™ä¸»å‡½æ•°ï¼Œå°±èƒ½ç›´æ¥è¿è¡Œäº†ã€‚åŒæ—¶åˆä¸ä¼¤å®³ go kit æ¶æ„æœ¬èº«çš„æ‰©å±•æ€§å’Œå¯å®šåˆ¶æ€§ã€‚</p>
<h2 id=æ€»ç»“>æ€»ç»“</h2>
<p><figure class=gallery-image style=flex-grow:78;flex-basis:189px>
<a href=/blog/p/my-opinion-of-gokit-architecture/image-20220302154943857.png data-size=420x533>
<img src=/blog/p/my-opinion-of-gokit-architecture/image-20220302154943857.png width=420 height=533 srcset="/blog/p/my-opinion-of-gokit-architecture/image-20220302154943857_hu9cb516ff1b199527543c48b61b9d85b3_16922_480x0_resize_box_3.png 480w, /blog/p/my-opinion-of-gokit-architecture/image-20220302154943857_hu9cb516ff1b199527543c48b61b9d85b3_16922_1024x0_resize_box_3.png 1024w" loading=lazy alt="go kitæ¶æ„çš„æœåŠ¡">
</a>
<figcaption>go kitæ¶æ„çš„æœåŠ¡</figcaption>
</figure></p>
<p>è›®å–œæ¬¢ go kit é¡¹ç›®ä½œè€…çš„ä¸€å¥è¯ï¼š</p>
<p><figure class=gallery-image style=flex-grow:416;flex-basis:1000px>
<a href=/blog/p/my-opinion-of-gokit-architecture/image-20220302155216922.png data-size=917x220>
<img src=/blog/p/my-opinion-of-gokit-architecture/image-20220302155216922.png width=917 height=220 srcset="/blog/p/my-opinion-of-gokit-architecture/image-20220302155216922_hu9feb75af39e108f8eeb86c8e5ed70db9_25876_480x0_resize_box_3.png 480w, /blog/p/my-opinion-of-gokit-architecture/image-20220302155216922_hu9feb75af39e108f8eeb86c8e5ed70db9_25876_1024x0_resize_box_3.png 1024w" loading=lazy alt=issueæˆªå›¾>
</a>
<figcaption>issueæˆªå›¾</figcaption>
</figure></p>
<blockquote>
<p>Honestly the best way to &ldquo;use&rdquo; Go kit is to cop it&rsquo;s architectural model and not actually import any of its packages at all ğŸ˜‰</p>
</blockquote>
<p>å…¶å®æˆ‘ä¹Ÿæƒ³æŠŠè¿™å¥—æ¶æ„æ¬è¿›é¡¹ç›®é‡Œï¼Œå¯æƒœæ¡ä»¶ä¸å…è®¸ï¼Œè¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜è¦å¤„ç†ï¼Œåªèƒ½å…ˆçœ¼é¦‹ä¸€ä¸‹ï¼Œå¸æ”¶ä¸‹ç²¾ç¥ã€‚</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/blog/tags/gokit/>gokit</a>
<a href=/blog/tags/golang/>golang</a>
<a href=/blog/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/>å¾®æœåŠ¡</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>ç›¸å…³æ–‡ç« </h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/blog/p/go-kit-note/>
<div class=article-details>
<h2 class=article-title>go-kit ç¬”è®°</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/grpc-gateway-used-as-multiple-grpc-server-gateway/>
<div class=article-details>
<h2 class=article-title>gRPC-Gateway ç”¨ä½œå¤šä¸ª gRPC æœåŠ¡çš„ç½‘å…³</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/protogen-code-generation/>
<div class=article-details>
<h2 class=article-title>protogenä»£ç ç”Ÿæˆ</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/stack-based-virtual-machine-for-minilang/>
<div class=article-details>
<h2 class=article-title>åŸºäºæ ˆçš„è™šæ‹Ÿæœº</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/a-s-exp-evaluator/>
<div class=article-details>
<h2 class=article-title>ä¸€ä¸ªsè¡¨è¾¾å¼æ±‚å€¼å™¨</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<link rel=stylesheet href=https://unpkg.com/vssue/dist/vssue.min.css>
<div id=vssue></div>
<script src=https://unpkg.com/vue/dist/vue.runtime.min.js></script>
<script src=https://unpkg.com/vssue/dist/vssue.github.min.js></script>
<script>new Vue({el:"#vssue",render:a=>a("Vssue",{props:{title:"gokit æ¶æ„ä¹‹æˆ‘è§",options:{autoCreateIssue:!1,owner:"nnnewb",repo:"blog",clientId:"285910fdc1567a1a23e3",clientSecret:"f00da5438d9ac82c4a86024866c7a916ae411edc"}}})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2022 weakptr's ç¬”è®°
</section>
<section class=powerby>
GitHub Pages <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">ç›®å½•</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#å‰è¨€>å‰è¨€</a></li>
<li><a href=#endpoint-æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨>endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨</a></li>
<li><a href=#generic-ä¼šå¦‚ä½•å½±å“-go-kit-æ¶æ„>generic ä¼šå¦‚ä½•å½±å“ go kit æ¶æ„</a></li>
<li><a href=#go-kit-ä»£ç ç”Ÿæˆ>go kit ä»£ç ç”Ÿæˆ</a></li>
<li><a href=#æ€»ç»“>æ€»ç»“</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>