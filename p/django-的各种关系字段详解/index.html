<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="参考资料如下
 Django 文档 - Model field reference SQLAlchemy 中的级联删除   1. ForeignKey ForeignKey用于多对一关系，直接对应到数据库外键的概念。使用ForeignKey需要指定引用的目标表，会自动关联到目标表的主键（一般是id字段）。
例子如下。
from django.db import models class Child(models.Model): parent = models.ForeignKey(&amp;#39;Parent&amp;#39;, on_delete=models.CASCADE, ) # ... class Parent(models.Model): # ... pass 对比之 sqlalchemy，一行parent=models.ForeignKey(...)包含了 sqlalchemy 中的ForeignKey和relationship两部分内容。
1.1 参数：on_delete on_delete意为当ForeignKey引用的对象被删除时进行的操作。
有几个可以考虑的选项。
1.1.1 models.CASCADE CASCADE意为级联，on_delete设置为CASCADE时意为执行级联删除。依据文档，Django 会模仿 SQL 的ON DELETE CASCADE，对包含了ForeignKey的对象执行删除。
需要注意的是不会调用被级联删除对象上的model.delete()，但是会发送pre_delete和post_delete信号。
1.1.1.2 models.PROTECT PROTECT意为保护，on_delete设置为PROTECT意味着要阻止删除操作发生。删除关联的对象时，ForeignKey的on_delete设置为PROTECT会触发ProtectedError。
1.1.1.3 models.SET_NULL 如其名所述，如果这个ForeignKey是 nullable 的，则关联的对象删除时将外键设置为 null。
1.1.1.4 models.SET_DEFAULT 如其名所述，如果这个ForeignKey设置了DEFAULT，则关联的对象删除时设置这个外键为DEFAULT值。
1.1.1.5 models.SET 在关联的对象删除时，设置为一个指定的值。这个参数可以接受一个可以赋值给这个 ForeignKey 的对象或者一个可调用对象。
官方例子如下。"><title>Django 的各种关系字段详解</title>
<link rel=canonical href=https://nnnewb.github.io/blog/p/django-%E7%9A%84%E5%90%84%E7%A7%8D%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/>
<link rel=stylesheet href=/blog/scss/style.min.css><meta property="og:title" content="Django 的各种关系字段详解">
<meta property="og:description" content="参考资料如下
 Django 文档 - Model field reference SQLAlchemy 中的级联删除   1. ForeignKey ForeignKey用于多对一关系，直接对应到数据库外键的概念。使用ForeignKey需要指定引用的目标表，会自动关联到目标表的主键（一般是id字段）。
例子如下。
from django.db import models class Child(models.Model): parent = models.ForeignKey(&amp;#39;Parent&amp;#39;, on_delete=models.CASCADE, ) # ... class Parent(models.Model): # ... pass 对比之 sqlalchemy，一行parent=models.ForeignKey(...)包含了 sqlalchemy 中的ForeignKey和relationship两部分内容。
1.1 参数：on_delete on_delete意为当ForeignKey引用的对象被删除时进行的操作。
有几个可以考虑的选项。
1.1.1 models.CASCADE CASCADE意为级联，on_delete设置为CASCADE时意为执行级联删除。依据文档，Django 会模仿 SQL 的ON DELETE CASCADE，对包含了ForeignKey的对象执行删除。
需要注意的是不会调用被级联删除对象上的model.delete()，但是会发送pre_delete和post_delete信号。
1.1.1.2 models.PROTECT PROTECT意为保护，on_delete设置为PROTECT意味着要阻止删除操作发生。删除关联的对象时，ForeignKey的on_delete设置为PROTECT会触发ProtectedError。
1.1.1.3 models.SET_NULL 如其名所述，如果这个ForeignKey是 nullable 的，则关联的对象删除时将外键设置为 null。
1.1.1.4 models.SET_DEFAULT 如其名所述，如果这个ForeignKey设置了DEFAULT，则关联的对象删除时设置这个外键为DEFAULT值。
1.1.1.5 models.SET 在关联的对象删除时，设置为一个指定的值。这个参数可以接受一个可以赋值给这个 ForeignKey 的对象或者一个可调用对象。
官方例子如下。">
<meta property="og:url" content="https://nnnewb.github.io/blog/p/django-%E7%9A%84%E5%90%84%E7%A7%8D%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/">
<meta property="og:site_name" content="weakptr's 笔记">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="django"><meta property="article:tag" content="python"><meta property="article:published_time" content="2019-03-06T21:11:35+08:00"><meta property="article:modified_time" content="2019-03-06T21:11:35+08:00">
<meta name=twitter:title content="Django 的各种关系字段详解">
<meta name=twitter:description content="参考资料如下
 Django 文档 - Model field reference SQLAlchemy 中的级联删除   1. ForeignKey ForeignKey用于多对一关系，直接对应到数据库外键的概念。使用ForeignKey需要指定引用的目标表，会自动关联到目标表的主键（一般是id字段）。
例子如下。
from django.db import models class Child(models.Model): parent = models.ForeignKey(&amp;#39;Parent&amp;#39;, on_delete=models.CASCADE, ) # ... class Parent(models.Model): # ... pass 对比之 sqlalchemy，一行parent=models.ForeignKey(...)包含了 sqlalchemy 中的ForeignKey和relationship两部分内容。
1.1 参数：on_delete on_delete意为当ForeignKey引用的对象被删除时进行的操作。
有几个可以考虑的选项。
1.1.1 models.CASCADE CASCADE意为级联，on_delete设置为CASCADE时意为执行级联删除。依据文档，Django 会模仿 SQL 的ON DELETE CASCADE，对包含了ForeignKey的对象执行删除。
需要注意的是不会调用被级联删除对象上的model.delete()，但是会发送pre_delete和post_delete信号。
1.1.1.2 models.PROTECT PROTECT意为保护，on_delete设置为PROTECT意味着要阻止删除操作发生。删除关联的对象时，ForeignKey的on_delete设置为PROTECT会触发ProtectedError。
1.1.1.3 models.SET_NULL 如其名所述，如果这个ForeignKey是 nullable 的，则关联的对象删除时将外键设置为 null。
1.1.1.4 models.SET_DEFAULT 如其名所述，如果这个ForeignKey设置了DEFAULT，则关联的对象删除时设置这个外键为DEFAULT值。
1.1.1.5 models.SET 在关联的对象删除时，设置为一个指定的值。这个参数可以接受一个可以赋值给这个 ForeignKey 的对象或者一个可调用对象。
官方例子如下。">
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"dark")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/blog class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/blog/categories/python/>
python
</a>
</header>
<h2 class=article-title>
<a href=/blog/p/django-%E7%9A%84%E5%90%84%E7%A7%8D%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3/>Django 的各种关系字段详解</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2019年 3月 6日</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
阅读时长: 2 分钟
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<blockquote>
<p>参考资料如下</p>
<ul>
<li><a class=link href=https://docs.djangoproject.com/zh-hans/2.1/ref/models/fields/ target=_blank rel=noopener>Django 文档 - Model field reference</a></li>
<li><a class=link href=https://graycarl.me/2014/03/24/sqlalchemy-cascade-delete.html target=_blank rel=noopener>SQLAlchemy 中的级联删除</a></li>
</ul>
</blockquote>
<h2 id=1-foreignkey>1. ForeignKey</h2>
<p><code>ForeignKey</code>用于多对一关系，直接对应到数据库外键的概念。使用<code>ForeignKey</code>需要指定引用的目标表，会自动关联到目标表的主键（一般是<code>id</code>字段）。</p>
<p>例子如下。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>

<span class=k>class</span> <span class=nc>Child</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>parent</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;Parent&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span> <span class=p>)</span>
    <span class=c1># ...</span>

<span class=k>class</span> <span class=nc>Parent</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=c1># ...</span>
    <span class=k>pass</span>
</code></pre></div><p>对比之 sqlalchemy，一行<code>parent=models.ForeignKey(...)</code>包含了 sqlalchemy 中的<code>ForeignKey</code>和<code>relationship</code>两部分内容。</p>
<h3 id=11-参数on_delete>1.1 参数：on_delete</h3>
<p><code>on_delete</code>意为当<code>ForeignKey</code>引用的对象被删除时进行的操作。</p>
<p>有几个可以考虑的选项。</p>
<h4 id=111-modelscascade>1.1.1 models.CASCADE</h4>
<p><code>CASCADE</code>意为级联，<code>on_delete</code>设置为<code>CASCADE</code>时意为执行级联删除。依据文档，Django 会模仿 SQL 的<code>ON DELETE CASCADE</code>，对包含了<code>ForeignKey</code>的对象执行删除。</p>
<p>需要注意的是不会调用被级联删除对象上的<code>model.delete()</code>，但是会发送<a class=link href=https://docs.djangoproject.com/zh-hans/2.1/ref/signals/#django.db.models.signals.pre_delete target=_blank rel=noopener><code>pre_delete</code></a>和<a class=link href=https://docs.djangoproject.com/zh-hans/2.1/ref/signals/#django.db.models.signals.post_delete target=_blank rel=noopener><code>post_delete</code></a>信号。</p>
<h4 id=1112-modelsprotect>1.1.1.2 models.PROTECT</h4>
<p><code>PROTECT</code>意为保护，<code>on_delete</code>设置为<code>PROTECT</code>意味着要阻止删除操作发生。删除关联的对象时，<code>ForeignKey</code>的<code>on_delete</code>设置为<code>PROTECT</code>会触发<code>ProtectedError</code>。</p>
<h4 id=1113-modelsset_null>1.1.1.3 models.SET_NULL</h4>
<p>如其名所述，如果这个<code>ForeignKey</code>是 nullable 的，则关联的对象删除时将外键设置为 null。</p>
<h4 id=1114-modelsset_default>1.1.1.4 models.SET_DEFAULT</h4>
<p>如其名所述，如果这个<code>ForeignKey</code>设置了<code>DEFAULT</code>，则关联的对象删除时设置这个外键为<code>DEFAULT</code>值。</p>
<h4 id=1115-modelsset>1.1.1.5 models.SET</h4>
<p>在关联的对象删除时，设置为一个指定的值。这个参数可以接受一个可以赋值给这个 ForeignKey 的对象或者一个可调用对象。</p>
<p>官方例子如下。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>django.conf</span> <span class=kn>import</span> <span class=n>settings</span>
<span class=kn>from</span> <span class=nn>django.contrib.auth</span> <span class=kn>import</span> <span class=n>get_user_model</span>
<span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>

<span class=k>def</span> <span class=nf>get_sentinel_user</span><span class=p>():</span>
    <span class=k>return</span> <span class=n>get_user_model</span><span class=p>()</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>get_or_create</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;deleted&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

<span class=k>class</span> <span class=nc>MyModel</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>user</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span>
        <span class=n>settings</span><span class=o>.</span><span class=n>AUTH_USER_MODEL</span><span class=p>,</span>
        <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>SET</span><span class=p>(</span><span class=n>get_sentinel_user</span><span class=p>),</span>
    <span class=p>)</span>
</code></pre></div><h4 id=1116-modelsdo_nothing>1.1.1.6 models.DO_NOTHING</h4>
<p>应该不用多说了吧。Django 不会做多余的事情，但是如果后端的数据库服务有强制完整性约束，除非你在数据库一端自己定义了<code>ON DELETE</code>，否则会触发<code>IntegrityError</code>。</p>
<h3 id=12-参数limited_choice_to>1.2 参数：limited_choice_to</h3>
<p>强制约束为 django.admin 或者 ModelForm 渲染时提供有限的可选项。</p>
<p>接受参数为<code>dict</code>或者<code>Q</code>对象、返回<code>Q</code>对象的可调用对象。</p>
<p>官方例子。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>staff_member</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span>
    <span class=n>User</span><span class=p>,</span>
    <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span>
    <span class=n>limit_choices_to</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;is_staff&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>},</span>
<span class=p>)</span>
</code></pre></div><p>Q 对象是什么玩意儿这个我搞明白了再说&mldr;</p>
<h3 id=13-参数related_name>1.3 参数：related_name</h3>
<p>设置反向关联的字段名，和<code>sqlalchemy</code>的<code>backref</code>类似。</p>
<p>举例来说。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>Child</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>parent</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;Parent&#39;</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>Parent</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=n>Parent</span><span class=o>.</span><span class=n>child_set</span><span class=o>.</span><span class=n>all</span><span class=p>()</span> <span class=c1># 未设置 related_name</span>
<span class=n>Parent</span><span class=o>.</span><span class=n>children</span><span class=o>.</span><span class=n>all</span><span class=p>()</span> <span class=c1># 设置 related_name=children</span>
</code></pre></div><h3 id=14-参数related_query_name>1.4 参数：related_query_name</h3>
<p>related_query_name 和 related_name 类似，设置反向引用查询时条件的前缀名。举例来说。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>Child</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>parent</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;Parent&#39;</span><span class=p>)</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>Parent</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=n>Parent</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>Child__name</span><span class=o>=</span><span class=s1>&#39;沙雕网友&#39;</span><span class=p>)</span> <span class=c1># 未设置 related_query_name</span>
<span class=n>Parent</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>myboy__name</span><span class=o>=</span><span class=s1>&#39;沙雕网友&#39;</span><span class=p>)</span> <span class=c1># 设置 related_query_name=myboy</span>
</code></pre></div><h3 id=15-参数to_field>1.5 参数：to_field</h3>
<p>得到<code>ForeignKey</code>关联的模型的字段，默认是主键，如果指定的不是主键那么必须有<code>unique</code>约束才行。</p>
<h3 id=16-参数db_constraint>1.6 参数：db_constraint</h3>
<p>要不要创建数据库层级的约束，也就是通过后端数据库服务确保数据完整性不受破坏。如果设置为 False 那么访问不存在的对象时会触发 DoesNotExists 异常。</p>
<h3 id=17-参数swappable>1.7 参数：swappable</h3>
<p>用于处理“我有一个抽象类模型但是这个模型有一个外键”的情况，典型就是<code>AUTH_USER_MODEL</code>。</p>
<p>一般不用改到，这个属性控制了数据库迁移时如何处理这个外键关联的表，总之保持默认值就行了。</p>
<p>这个功能支持了使用自定义的用户模型替代 <code>django.auth.models.User</code> 之类的玩意儿。</p>
<h2 id=2-onetoonefield>2. OneToOneField</h2>
<p><code>OneToOneField</code> 基本就是一个加了<code>unique</code>约束的<code>ForeignKey</code>。使用上与 ForeignKey 略有不同。</p>
<p>首先是访问 <code>OneToOneField</code> 时，得到的不是 <code>QuerySet</code> 而是一个对象实例。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># 优生优育政策（</span>
<span class=k>class</span> <span class=nc>Parent</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>child</span> <span class=o>=</span> <span class=n>OneToOneField</span><span class=p>(</span><span class=s1>&#39;Child&#39;</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>Child</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=n>parent</span><span class=o>.</span><span class=n>child</span> <span class=c1># =&gt; 得到一个 Child 实例</span>
</code></pre></div><p>其次是反向引用的名字是模型名字小写。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>child</span><span class=o>.</span><span class=n>parent</span> <span class=c1># =&gt; 得到一个 Parent 实例</span>
</code></pre></div><p>如果指定 <code>related_name</code> 那就和 <code>ForeignKey</code> 一个表现。</p>
<h2 id=3-manytomanyfield>3. ManyToManyField</h2>
<p>基本和<code>ForeignKey</code>相同。</p>
<h3 id=31-和-foreignkey-相同的参数>3.1 和 <code>ForeignKey</code> 相同的参数</h3>
<ul>
<li>related_name</li>
<li>related_query_name</li>
<li>limited_choices_to</li>
<li>db_constraint</li>
<li>swappable</li>
</ul>
<p>limited_choices_to 在指定自定义中间表的情况下无效。</p>
<h3 id=32-参数symmetrical>3.2 参数：symmetrical</h3>
<p>用于处理一个表自己对自己的多对多引用对称性。</p>
<p>Django 的默认行为是，我是你的朋友，那么你就是我的朋友。</p>
<p>设置了这个参数则强迫 Django 改变这个行为，允许“被朋友”。</p>
<h3 id=33-参数through>3.3 参数：through</h3>
<p>默认情况下，Django 会自行创建中间表，这个参数强制指定中间表。</p>
<p>默认中间表模型里包含三个字段。</p>
<ul>
<li>id</li>
<li>&lt;containing_model>_id</li>
<li>&lt;other_model>_id</li>
</ul>
<p>如果是自己和自己的多对多关系，则</p>
<ul>
<li>id</li>
<li>from_&lt;model>_id</li>
<li>to_&lt;model>_id</li>
</ul>
<h3 id=34-参数through_fields>3.4 参数：through_fields</h3>
<p>当自行指定中间表，中间表又包含了多个外键时，指定关联的外键用。</p>
<p>举例。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>ModelA</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>b</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=n>ModelB</span><span class=p>,</span> <span class=n>through</span><span class=o>=</span><span class=s1>&#39;ModelC&#39;</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>ModelB</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=k>class</span> <span class=nc>ModelC</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>a</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;ModelA&#39;</span><span class=p>)</span>
    <span class=n>b</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;ModelB&#39;</span><span class=p>)</span>
    <span class=n>c</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;ModelA&#39;</span><span class=p>)</span>
</code></pre></div><p>此时在中间表中<code>a</code>和<code>c</code>都是对<code>ModelA</code>的外键，产生了歧义，Django 无法自行决定用哪个外键来关联 AB 两个表。</p>
<p>这时提供参数。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>b</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=s1>&#39;ModelB&#39;</span><span class=p>,</span> <span class=n>through</span><span class=o>=</span><span class=s1>&#39;ModelC&#39;</span><span class=p>,</span> <span class=n>through_fields</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</code></pre></div><p><code>ManyToManyField</code> 关联两个表总是不对称的关系（指我把你当兄弟，你却想当我爸爸这样的关系。此时“我”对“你”的“兄弟”关系就是单向的。），这就形成了<strong>来源</strong>和<strong>目标</strong>的概念。</p>
<p><code>through_fields</code> 的第一个元素总被认为是<strong>来源</strong>字段，第二个元素是<strong>目标</strong>字段。</p>
<h3 id=35-参数db_table>3.5 参数：db_table</h3>
<p>指定 Django 创建的中间表的名字，默认根据两个表表名和 <code>ManyToManyField</code> 的名字决定。</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/blog/tags/django/>django</a>
<a href=/blog/tags/python/>python</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>相关文章</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/blog/p/%E8%BD%BB%E9%87%8F%E7%BA%A7-django-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E6%9C%80%E5%B0%8F%E7%9A%84-django-%E5%BA%94%E7%94%A8/>
<div class=article-details>
<h2 class=article-title>轻量级 django 阅读笔记：最小的 django 应用</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/pattern-match-in-python310/>
<div class=article-details>
<h2 class=article-title>pattern-match-in-python310</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/flask%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0wsgi/>
<div class=article-details>
<h2 class=article-title>Flask源码阅读笔记：WSGI</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/sqlalchemy-%E5%90%84%E7%A7%8D%E8%A1%A8%E5%85%B3%E7%B3%BB/>
<div class=article-details>
<h2 class=article-title>sqlalchemy 各种表关系</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/%E5%88%A9%E7%94%A8-descriptor-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84-property/>
<div class=article-details>
<h2 class=article-title>利用 descriptor 实现自己的 property</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 weakptr's 笔记
</section>
<section class=powerby>
GitHub Pages <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">目录</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#1-foreignkey>1. ForeignKey</a>
<ol>
<li><a href=#11-参数on_delete>1.1 参数：on_delete</a>
<ol>
<li><a href=#111-modelscascade>1.1.1 models.CASCADE</a></li>
<li><a href=#1112-modelsprotect>1.1.1.2 models.PROTECT</a></li>
<li><a href=#1113-modelsset_null>1.1.1.3 models.SET_NULL</a></li>
<li><a href=#1114-modelsset_default>1.1.1.4 models.SET_DEFAULT</a></li>
<li><a href=#1115-modelsset>1.1.1.5 models.SET</a></li>
<li><a href=#1116-modelsdo_nothing>1.1.1.6 models.DO_NOTHING</a></li>
</ol>
</li>
<li><a href=#12-参数limited_choice_to>1.2 参数：limited_choice_to</a></li>
<li><a href=#13-参数related_name>1.3 参数：related_name</a></li>
<li><a href=#14-参数related_query_name>1.4 参数：related_query_name</a></li>
<li><a href=#15-参数to_field>1.5 参数：to_field</a></li>
<li><a href=#16-参数db_constraint>1.6 参数：db_constraint</a></li>
<li><a href=#17-参数swappable>1.7 参数：swappable</a></li>
</ol>
</li>
<li><a href=#2-onetoonefield>2. OneToOneField</a></li>
<li><a href=#3-manytomanyfield>3. ManyToManyField</a>
<ol>
<li><a href=#31-和-foreignkey-相同的参数>3.1 和 <code>ForeignKey</code> 相同的参数</a></li>
<li><a href=#32-参数symmetrical>3.2 参数：symmetrical</a></li>
<li><a href=#33-参数through>3.3 参数：through</a></li>
<li><a href=#34-参数through_fields>3.4 参数：through_fields</a></li>
<li><a href=#35-参数db_table>3.5 参数：db_table</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>