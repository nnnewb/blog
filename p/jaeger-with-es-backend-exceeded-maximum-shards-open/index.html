<!doctype html><html lang=zh-cn dir=ltr>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="å‰è¨€ jaeger æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åˆ†å¸ƒå¼è¿½è¸ªæœåŠ¡ï¼Œåç«¯å¯ä»¥é€‰ esã€cassandra ç­‰å­˜å‚¨ï¼Œæˆ‘å¸çº¿ä¸Šå°±æ˜¯ç”¨äº† es ä½œä¸º jaeger å­˜å‚¨ã€‚ jaeger ç”¨ es åšæŸ¥è¯¢åç«¯çš„æ—¶å€™æœ‰ä¸ªåæ¯›"><title>è®°ä¸€æ¬¡ jaeger es åç«¯å‡ºç° maximum shards open é”™è¯¯æ’æŸ¥</title>
<link rel=canonical href=https://nnnewb.github.io/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/>
<link rel=stylesheet href=/blog/scss/style.min.5c88a5bc75732c20b0a5ccc3be5c148f782b1c20e20b6c73b276723850a33d6b.css><script src=https://unpkg.com/dayjs@1.8.21/dayjs.min.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/plugin/relativeTime.js></script>
<script src=https://unpkg.com/dayjs@1.8.21/locale/zh-cn.js></script>
<script>dayjs.locale('zh-cn'),dayjs.extend(dayjs_plugin_relativeTime)</script><meta property="og:title" content="è®°ä¸€æ¬¡ jaeger es åç«¯å‡ºç° maximum shards open é”™è¯¯æ’æŸ¥">
<meta property="og:description" content="å‰è¨€ jaeger æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åˆ†å¸ƒå¼è¿½è¸ªæœåŠ¡ï¼Œåç«¯å¯ä»¥é€‰ esã€cassandra ç­‰å­˜å‚¨ï¼Œæˆ‘å¸çº¿ä¸Šå°±æ˜¯ç”¨äº† es ä½œä¸º jaeger å­˜å‚¨ã€‚ jaeger ç”¨ es åšæŸ¥è¯¢åç«¯çš„æ—¶å€™æœ‰ä¸ªåæ¯›">
<meta property="og:url" content="https://nnnewb.github.io/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/">
<meta property="og:site_name" content="weakptr's ç¬”è®°">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="elasticsearch"><meta property="article:tag" content="kubernetes"><meta property="article:tag" content="jaeger"><meta property="article:published_time" content="2022-04-12T13:00:00+08:00"><meta property="article:modified_time" content="2022-04-12T13:00:00+08:00">
<meta name=twitter:title content="è®°ä¸€æ¬¡ jaeger es åç«¯å‡ºç° maximum shards open é”™è¯¯æ’æŸ¥">
<meta name=twitter:description content="å‰è¨€ jaeger æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åˆ†å¸ƒå¼è¿½è¸ªæœåŠ¡ï¼Œåç«¯å¯ä»¥é€‰ esã€cassandra ç­‰å­˜å‚¨ï¼Œæˆ‘å¸çº¿ä¸Šå°±æ˜¯ç”¨äº† es ä½œä¸º jaeger å­˜å‚¨ã€‚ jaeger ç”¨ es åšæŸ¥è¯¢åç«¯çš„æ—¶å€™æœ‰ä¸ªåæ¯›">
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"dark")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header>
<figure class=site-avatar>
<a href=/blog>
<img src=/blog/img/avatar_hub37949326d1692892aa1e64434c0dda6_382115_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a>
<span class=emoji>ğŸ‘</span>
</figure>
<div class=site-meta>
<h1 class=site-name><a href=/blog>weakptr's ç¬”è®°</a></h1>
<h2 class=site-description>å¼ƒèˆ¹ï¼</h2>
</div>
</header><ol class=social-menu>
<li>
<a href=https://github.com/nnnewb/ target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
</ol><ol class=menu id=main-menu>
<li>
<a href=/blog><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>é¦–é¡µ</span>
</a>
</li>
<li>
<a href=/blog/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äºæˆ‘</span>
</a>
</li>
<li>
<a href=/blog/archive><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span>
</a>
</li>
<li>
<a href=/blog/categories><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>åˆ†ç±»</span>
</a>
</li>
<li>
<a href=/blog/link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>å‹é“¾</span>
</a>
</li>
<li>
<a href=/blog/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span>
</a>
</li>
<div class=menu-bottom-section>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/blog/categories/elasticsearch/>
elasticsearch
</a>
</header>
<div class=article-title-wrapper>
<h2 class=article-title>
<a href=/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/>è®°ä¸€æ¬¡ jaeger es åç«¯å‡ºç° maximum shards open é”™è¯¯æ’æŸ¥</a>
</h2>
</div>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2022-04-12T13:00:00+08:00>2022å¹´ 4æœˆ 12æ—¥</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
é˜…è¯»æ—¶é•¿: 10 åˆ†é’Ÿ
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=å‰è¨€>å‰è¨€</h2>
<p>jaeger æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åˆ†å¸ƒå¼è¿½è¸ªæœåŠ¡ï¼Œåç«¯å¯ä»¥é€‰ esã€cassandra ç­‰å­˜å‚¨ï¼Œæˆ‘å¸çº¿ä¸Šå°±æ˜¯ç”¨äº† es ä½œä¸º jaeger å­˜å‚¨ã€‚</p>
<p>jaeger ç”¨ es åšæŸ¥è¯¢åç«¯çš„æ—¶å€™æœ‰ä¸ªåæ¯›ç—…ï¼šå®ƒä¼šè‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†å‰²æ—¥å¿— spanï¼Œä¸€å¤©ä¸€ä¸ª indexã€‚ç›´æ¥ç»“æœå°±æ˜¯ä¸€æ®µæ—¶é—´æ²¡ç®¡çº¿ä¸Šçš„ jaegerï¼Œè¿‡ä¸€æ®µæ—¶é—´å°±ä¼šå‘ç° jaege é‡Œå•¥ä¹ŸæŸ¥ä¸å‡ºæ¥äº†ã€‚ç¿» jaeger çš„æ—¥å¿—å°±ä¼šçœ‹åˆ°ä¸‹é¢çš„å†…å®¹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span>
    <span class=nt>&#34;ts&#34;</span><span class=p>:</span> <span class=mf>1649751249.9240348</span><span class=p>,</span>
    <span class=nt>&#34;caller&#34;</span><span class=p>:</span> <span class=s2>&#34;config/config.go:141&#34;</span><span class=p>,</span>
    <span class=nt>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;Elasticsearch part of bulk request failed&#34;</span><span class=p>,</span>
    <span class=nt>&#34;map-key&#34;</span><span class=p>:</span> <span class=s2>&#34;index&#34;</span><span class=p>,</span>
    <span class=nt>&#34;response&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;_index&#34;</span><span class=p>:</span> <span class=s2>&#34;jaeger-span-2022-04-12&#34;</span><span class=p>,</span>
        <span class=nt>&#34;_type&#34;</span><span class=p>:</span> <span class=s2>&#34;_doc&#34;</span><span class=p>,</span>
        <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
        <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;illegal_argument_exception&#34;</span><span class=p>,</span>
            <span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;Validation Failed: 1: this action would add [10] total shards, but this cluster currently has [2998]/[3000] maximum shards open;&#34;</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=nt>&#34;stacktrace&#34;</span><span class=p>:</span> <span class=s2>&#34;github.com/jaegertracing/jaeger/pkg/es/config.(*Configuration).NewClient.func2\n\tgithub.com/jaegertracing/jaeger/pkg/es/config/config.go:141\ngithub.com/olivere/elastic.(*bulkWorker).commit\n\tgithub.com/olivere/elastic@v6.2.35+incompatible/bulk_processor.go:588\ngithub.com/olivere/elastic.(*bulkWorker).work\n\tgithub.com/olivere/elastic@v6.2.35+incompatible/bulk_processor.go:501&#34;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶æ£€æŸ¥ <code>GET /_cat/shards</code> æˆ– <code>GET /_cat/allocation</code> éƒ½èƒ½çœ‹åˆ°åˆ†ç‰‡æ•°é‡è¾¾åˆ°äº†æ—¥å¿—é‡Œè®°å½•çš„ <code>2998</code> ä¸ªã€‚</p>
<h2 id=åŸå› >åŸå› </h2>
<h3 id=jaegeräº§ç”Ÿå¤§é‡åˆ†ç‰‡>jaegeräº§ç”Ÿå¤§é‡åˆ†ç‰‡</h3>
<p><a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/current/size-your-shards.html target=_blank rel=noopener>elasticsearch å®˜æ–¹æ–‡æ¡£æŒ‡å‡º</a>ï¼Œæ¯ä¸ª index ä¼šè¢«åˆ‡åˆ†æˆ1æˆ–å¤šä¸ªåˆ†ç‰‡(shards)ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½å¯èƒ½åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ï¼Œä»¥é˜²ç¡¬ä»¶æ•…éšœã€‚</p>
<blockquote>
<p>Each index in Elasticsearch is divided into one or more shards, each of which may be replicated across multiple nodes to protect against hardware failures.</p>
</blockquote>
<p>è€Œæ®æˆ‘è§‚å¯Ÿï¼ˆsorryï¼Œæ²¡æœ‰æ–‡æ¡£ï¼‰ï¼Œjaeger æ¯å¤©åˆ›å»ºçš„ index éƒ½åŒ…å«è‡³å°‘ 5 ä¸ª primary åˆ†ç‰‡ï¼Œä¸€ä¸ª replica åˆ†ç‰‡ã€‚å¯ä»¥é€šè¿‡è¯·æ±‚<code>index/_settings</code>è¿™ä¸ªapiç«¯ç‚¹æ¥æ£€æŸ¥ç´¢å¼•ä¼šåˆ†é…çš„åˆ†ç‰‡å’Œå†—ä½™æ•°é‡ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
<span class=n>content-encoding</span><span class=o>:</span> <span class=l>gzip</span>
<span class=n>content-length</span><span class=o>:</span> <span class=l>239</span>
<span class=n>content-type</span><span class=o>:</span> <span class=l>application/json; charset=UTF-8</span>

<span class=p>{</span>
    <span class=nt>&#34;jaeger-span-2022-04-12&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=p>{</span>
                <span class=nt>&#34;creation_date&#34;</span><span class=p>:</span> <span class=s2>&#34;1649749148182&#34;</span><span class=p>,</span>
                <span class=nt>&#34;mapping&#34;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=nt>&#34;nested_fields&#34;</span><span class=p>:</span> <span class=p>{</span>
                        <span class=nt>&#34;limit&#34;</span><span class=p>:</span> <span class=s2>&#34;50&#34;</span>
                    <span class=p>}</span>
                <span class=p>},</span>
                <span class=nt>&#34;number_of_replicas&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
                <span class=nt>&#34;number_of_shards&#34;</span><span class=p>:</span> <span class=s2>&#34;5&#34;</span><span class=p>,</span>
                <span class=nt>&#34;provided_name&#34;</span><span class=p>:</span> <span class=s2>&#34;jaeger-span-2022-04-12&#34;</span><span class=p>,</span>
                <span class=nt>&#34;requests&#34;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=nt>&#34;cache&#34;</span><span class=p>:</span> <span class=p>{</span>
                        <span class=nt>&#34;enable&#34;</span><span class=p>:</span> <span class=s2>&#34;true&#34;</span>
                    <span class=p>}</span>
                <span class=p>},</span>
                <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;s2i5GZtpTzm3Kp4fIldwrQ&#34;</span><span class=p>,</span>
                <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=nt>&#34;created&#34;</span><span class=p>:</span> <span class=s2>&#34;7090199&#34;</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>è€Œæ£€æŸ¥ <code>GET /_cat/indices</code> å¯ä»¥å‘ç°ï¼Œ<code>jaeger</code> åˆ›å»ºçš„ index åŒ…æ‹¬ <code>jaeger-service-yyyy-mm-dd</code> å’Œ <code>jaeger-span-yyyy-mm-dd</code> ä¸¤ç§ï¼Œå¾ˆå®¹æ˜“ç®—å‡ºé¢„æœŸæ¯æœˆå¯èƒ½äº§ç”Ÿ 336~372 ä¸ªæ–°çš„åˆ†ç‰‡ã€‚</p>
<h3 id=esæ¯ä¸ªèŠ‚ç‚¹åˆ†ç‰‡æ•°é‡å—é™>esæ¯ä¸ªèŠ‚ç‚¹åˆ†ç‰‡æ•°é‡å—é™</h3>
<p>å…³äºèŠ‚ç‚¹åˆ†ç‰‡æ•°é‡é™åˆ¶ï¼Œ<a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html target=_blank rel=noopener>å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•</a>æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p><strong><code>index.routing.allocation.total_shards_per_node</code></strong></p>
<p>The maximum number of shards (replicas and primaries) that will be allocated to a single node. Defaults to unbounded.</p>
<p>&mldr;</p>
<p><strong><code>cluster.routing.allocation.total_shards_per_node</code></strong></p>
<p>(<a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting target=_blank rel=noopener>Dynamic</a>) Maximum number of primary and replica shards allocated to each node. Defaults to <code>-1</code> (unlimited).</p>
<p>&mldr;</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯é»˜è®¤ä¸é™åˆ¶ï¼Œä½†æ˜¾ç„¶æˆ‘ä»¬é‡åˆ°çš„æƒ…å†µä¸æ˜¯è¿™æ ·ï¼Œè¦æ˜¯ shards æ•°é‡ä¸é™åˆ¶çš„è¯å°±æ ¹æœ¬æ²¡ç°åœ¨çš„é—®é¢˜äº†ã€‚</p>
<p>æ‰€ä»¥åœ¨ä¸œç¿»è¥¿æ‰¾äº†ä¸€è½®ä¹‹åï¼Œæˆ‘å‘ç°è¿˜æœ‰å¦ä¸€ä¸ªè®¾ç½®é¡¹ã€‚è¿™ä¸ªè®¾ç½®é¡¹ç”¨ <code>shards per node limits</code> å½“å…³é”®è¯æœç´¢çš„æ—¶å€™æ²¡æ‰¾åˆ°ï¼Œåœ¨ <code>GET /_cluster/settings?include_defaults</code> é‡Œç¿»å‡ºæ¥äº†ï¼š<code>max_shards_per_node</code>ã€‚</p>
<p>ç„¶åæˆ‘åœ¨æ–‡æ¡£é‡Œæœäº†ä¸‹ï¼Œå‘ç°å®˜æ–¹æ–‡æ¡£å…¶å®å·²ç»åšäº†SEOï¼Œæˆ‘è¦æ˜¯ç›´æ¥æŠŠé”™è¯¯ä¿¡æ¯è´´è¿›è°·æ­Œæœçš„è¯è¯´ä¸å®šæ—©å‘ç°è¿™ä¸ªé…ç½®é¡¹äº†&mldr;</p>
<blockquote>
<p>this action would add [x] total shards, but this cluster currently has [y]/[z] maximum shards open;</p>
<p>The <a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/8.1/modules-cluster.html#cluster-max-shards-per-node target=_blank rel=noopener><code>cluster.max_shards_per_node</code></a> cluster setting limits the maximum number of open shards for a cluster. This error indicates an action would exceed this limit.</p>
</blockquote>
<p><code>max_shards_per_node</code>çš„æ–‡æ¡£ä¹Ÿå¾ˆæ€ªï¼š</p>
<blockquote>
<p><strong><code>cluster.max_shards_per_node</code></strong></p>
<p>(<a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/8.1/settings.html#dynamic-cluster-setting target=_blank rel=noopener>Dynamic</a>) Limits the total number of primary and replica shards for the cluster. Elasticsearch calculates the limit as follows:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cluster.max_shards_per_node * number of non-frozen data nodes
</code></pre></td></tr></table>
</div>
</div><p>Shards for closed indices do not count toward this limit. Defaults to <code>1000</code>. A cluster with no data nodes is unlimited.</p>
</blockquote>
<p>è™½ç„¶å­—é¢ä¸Šçœ‹å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥assignçš„åˆ†ç‰‡æ•°é‡ï¼Œä½†å®é™…ç®—çš„æ˜¯ <code>total number of primary and replica shards for cluster</code>ã€‚å¯ä»¥ç®€å•ç®—ä¸€ä¸‹ï¼Œå•èŠ‚ç‚¹é›†ç¾¤æ˜¾ç„¶åªæœ‰ä¸€ä¸ª <code>non-frozen data node</code>ï¼Œæ‰€ä»¥é›†ç¾¤çš„åˆ†ç‰‡ä¸Šé™å°±æ˜¯ <code>1000 * 1</code>ã€‚çº¿ä¸Šçš„ 3 èŠ‚ç‚¹é›†ç¾¤æ²¡æœ‰ <code>frozen data node</code>ï¼Œæ‰€ä»¥å…¨é›†ç¾¤æœ€å¤šæœ‰ <code>1000*3</code> ä¸ªåˆ†ç‰‡ã€‚</p>
<p>å¥½äº†é—®é¢˜æ¥äº†ï¼Œ<code>max_shards_per_node</code> å’Œ <code>total_shards_per_node</code> æœ‰å•¥åŒºåˆ«ï¼Ÿ</p>
<p><code>total_shards_per_node</code> é™åˆ¶çš„æ˜¯ <strong>ä¸€ä¸ªèŠ‚ç‚¹èƒ½åˆ†é…å¤šå°‘åˆ†ç‰‡</strong>ï¼Œ<code>max_shards_per_node</code> æ˜¯ <strong>è®¡ç®—å…¨é›†ç¾¤èƒ½åˆ†é…å¤šå°‘åˆ†ç‰‡</strong> ã€‚</p>
<p>ä¾‹å¦‚ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤é‡Œï¼Œ<code>total_shards_per_node</code> æ˜¯ <code>100</code>ï¼Œä½† <code>max_shards_per_node</code> æ˜¯ <code>1000</code>ï¼Œå¯ä»¥åˆ›å»ºå‡ºè¶…è¿‡<code>100</code>ä¸ªåˆ†ç‰‡ï¼Œä½†è¶…å‡ºçš„åˆ†ç‰‡ä¸ä¼šè¢«åˆ†é…ï¼ˆæ²¡æœ‰å®éªŒè¿‡ï¼Œæˆ‘çŒœæ˜¯ä¸ä¼š assignï¼‰ã€‚</p>
<p>åè¿‡æ¥è¯´ <code>total_shards_per_node</code> æ¯” <code>max_shards_per_node</code> å¤§çš„æ—¶å€™ï¼Œè™½ç„¶èŠ‚ç‚¹è¿˜èƒ½åˆ†é…æ›´å¤šåˆ†ç‰‡ï¼Œä½†é›†ç¾¤åˆ†ç‰‡æ•°å·²ç»åˆ°ä¸Šé™äº†ï¼Œå°±ä¼šå‡ºç° <code>this action would add [x] total shards, but this cluster currently has [y]/[z] maximum shards open;</code> é”™è¯¯äº†ã€‚</p>
<h2 id=å¤„ç†>å¤„ç†</h2>
<p>æ€»çš„æ¥è¯´ï¼Œæ—¢ç„¶æ˜¯é›†ç¾¤å†…çš„ <code>max_shards_per_node</code> é…ç½®å°äº†ï¼Œè§£å†³æ–¹æ³•å°±å¾ˆå¤šï¼š</p>
<ol>
<li>æŠŠ <code>max_shards_per_node</code> è°ƒå¤§ï¼Œæ¯”å¦‚<code>10000</code>ï¼Œç›´æ¥10å€ã€‚</li>
<li>åŠ  es æœåŠ¡èŠ‚ç‚¹ã€‚</li>
<li>åˆ æ—§çš„ jaeger ç´¢å¼•ã€‚</li>
</ol>
<p>æ”¹é…ç½®æ˜¾ç„¶æ˜¯æœ‰ç‚¹ç¦»è°±çš„æƒ³æ³•ï¼Œç­‰äºæ˜¯çœ‹åˆ°èŸ‘è‚åœ¨è„šä¸‹ï¼Œä½ é€‰æ‹©é“ºå¼ åœ°æ¯¯ï¼Œçœ¼ä¸è§å¿ƒä¸çƒ¦ã€‚</p>
<p>åŠ èŠ‚ç‚¹åªé€‚åˆä¸å·®é’±çš„å…¬å¸ï¼Œè€Œä¸”è¿™ä¹ˆé€‰å¤šå°‘æ˜¯æœ‰ç‚¹çœ‹å…¬å¸äººå‚»é’±å¤šçš„æ„æ€ã€‚</p>
<p>åˆ é™¤æ—§ç´¢å¼•å°±æ­£å¸¸å¾ˆå¤šï¼Œç®—æ˜¯ç»å…¸æ“ä½œã€‚æ›´æ—©äº›å¹´åº”è¯¥è¿˜æœ‰ä¸ªäººç«™é•¿å†™ crontab è‡ªåŠ¨åˆ  <code>/var/log</code> æ—¥å¿—çš„ï¼Œåˆ æ—§ç´¢å¼•æœ¬è´¨å·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚</p>
<p>è€Œæ¸…ç†æ—§ç´¢å¼•ä¹Ÿæœ‰å¾ˆå¤šåšæ³•ã€‚</p>
<h3 id=jaeger-es-rollover>jaeger-es-rollover</h3>
<h4 id=åˆå§‹åŒ–>åˆå§‹åŒ–</h4>
<p><strong>æ³¨æ„ï¼Œæˆ‘æ— æ³•ç¡®å®šæ˜¯å¦å¯¹æœªå¯ç”¨<code>--es.use-aliases</code>æ—¶åˆ›å»ºçš„ç´¢å¼•æœ‰æ•ˆã€‚</strong></p>
<p><strong>æ³¨æ„ï¼Œrollover init ä¹Ÿä¼šåˆ›å»ºç´¢å¼•å’Œåˆ†ç‰‡ï¼Œå¦‚æœä½ å·²ç»ç¢°åˆ°äº†ä¸Šé¢çš„é—®é¢˜ï¼Œç›´æ¥ rollover init ä¼šå¤±è´¥ï¼Œå¿…é¡»å…ˆæ‰‹åŠ¨æ¸…ç†ã€‚</strong></p>
<p><strong>å¦‚æœåªæƒ³çœ‹å¦‚ä½•æ¸…ç†æ—§ç´¢å¼•ï¼Œè¯·è·³åˆ° åˆ é™¤ éƒ¨åˆ†ï¼Œè¿˜ä¸è¡Œå°±è·³åˆ° curator å°èŠ‚ã€‚</strong></p>
<p>search indices ä¸€èŠ‚æ‰€è¿°ï¼Œå¯ä»¥ä½¿ç”¨ jaeger-es-rollover è§£å†³ä»¥ es ä½œä¸ºåç«¯å­˜å‚¨æ—¶çš„ jaeger æ—¥å¿—è½®è½¬é—®é¢˜ã€‚æˆ‘è¦åæ§½ä¸‹ï¼ŒåŸæ–‡ï¼š</p>
<p>å‚è€ƒ <a class=link href=https://www.jaegertracing.io/docs/1.32/deployment/#shards-and-replicas-for-elasticsearch-indices target=_blank rel=noopener>jaeger éƒ¨ç½²æ–‡æ¡£ä¸­ shards and replicas for elasticsearch indices ä¸€èŠ‚æ‰€è¿°</a>ï¼Œå¯ä»¥ä½¿ç”¨ <code>jaeger-es-rollover</code> è§£å†³ä»¥ es ä½œä¸ºåç«¯å­˜å‚¨æ—¶çš„ jaeger æ—¥å¿—è½®è½¬é—®é¢˜ã€‚æˆ‘è¦åæ§½ä¸‹ï¼ŒåŸæ–‡ï¼š</p>
<blockquote>
<p>Shards and replicas are some configuration values to take special attention to, because this is decided upon index creation. <a class=link href=https://qbox.io/blog/optimizing-elasticsearch-how-many-shards-per-index target=_blank rel=noopener>This article</a> goes into more information about choosing how many shards should be chosen for optimization.</p>
</blockquote>
<p>æ²¡æœ‰ä»»ä½•æœªé…ç½® es æ—¥å¿—è½®è½¬å¯èƒ½äº§ç”Ÿçš„é—®é¢˜çš„è­¦å‘Šã€‚æˆ‘æ€ä¹ˆçŸ¥é“<code>take special attention to</code>æ˜¯æŒ‡æ€§èƒ½ä¼šåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‹‰èƒ¯ï¼Œè¿˜æ˜¯ç›´æ¥æŠŠ es æœåŠ¡çš„ shards å æ»¡ï¼Œç›´æ¥æå¾— es æ²¡æ³•æœåŠ¡ï¼Ÿ<code>This article</code> è¿™ä¸ªé“¾æ¥æ›´ç¦»è°±äº†ï¼ŒåŠå¥æ²¡æä¸ºä»€ä¹ˆåé¢æœ‰ä¸ª <code>elasticsearch rollover</code> å°ç»“ã€‚</p>
<p>å¥½é—²è¯å°‘å™ã€‚æˆ‘è¿™é‡Œæ˜¯ kubernetes å¹³å°ï¼Œdocker-compose ç”¨æˆ·æˆ–è€…çœŸæœºéƒ¨ç½²çš„è‡ªå·±çœ‹ç€æ”¹ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>kubectl create job --image jaegertracing/jaeger-es-rollover:latest jaeger-es-rollover-init -- /go/bin/es-rollover init http://elasticsearch-es-http.elasticsearch.svc.cluster.local:9200 --es.username<span class=o>=</span>***censored*** --es.password<span class=o>=</span>***censored***
</code></pre></td></tr></table>
</div>
</div><p>æ¢æˆ docker å‘½ä»¤å°±æ˜¯</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>docker run -it --rm --net<span class=o>=</span>host jaegertracing/jaeger-es-rollover:latest init http://localhost:9200 --es.username<span class=o>=</span>***censored*** --es.password<span class=o>=</span>***censored***
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸€æ­¥ä¼šåˆ›å»ºå‡ ä¸ªæ–°çš„ index å’Œåˆ«å</p>
<p><img src=/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141559066.png width=1842 height=378 srcset="/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141559066_huf31b44a88e85ce036ecd9f25c7699fa0_33804_480x0_resize_box_3.png 480w, /blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141559066_huf31b44a88e85ce036ecd9f25c7699fa0_33804_1024x0_resize_box_3.png 1024w" loading=lazy alt="rollover initå" class=gallery-image data-flex-grow=487 data-flex-basis=1169px></p>
<p>æ³¨æ„å›¾ä¸­æ ‡è®°çš„éƒ¨åˆ†ã€‚</p>
<p>ä¸‹ä¸€æ­¥ä¿®æ”¹ jaeger çš„å¯åŠ¨å‚æ•°ï¼Œæˆ‘è¿™é‡Œç›´æ¥ <code>kubectl edit -n jaeger deployment jaeger</code> ç¼–è¾‘ã€‚</p>
<p><img src=/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141913088.png width=885 height=169 srcset="/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141913088_hu4a18394a943caa248bfd6f08f6042657_22472_480x0_resize_box_3.png 480w, /blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413141913088_hu4a18394a943caa248bfd6f08f6042657_22472_1024x0_resize_box_3.png 1024w" loading=lazy alt=å¯åŠ¨å‚æ•° class=gallery-image data-flex-grow=523 data-flex-basis=1256px></p>
<p>åº”ç”¨åè‡ªåŠ¨æ›´æ–° podï¼Œæ³¨æ„çœ‹ä¸‹æ—¥å¿—æœ‰æ²¡æœ‰é”™è¯¯æˆ–è€…è­¦å‘Šã€‚å¯¹äº docker-compose ç”¨æˆ·æ”¹æ³•å·®ä¸å¤šï¼Œå¦‚æœ jaeger æ˜¯ç›´æ¥ <code>docker run</code> èµ·æ¥çš„ï¼Œé‚£æ˜¯çœŸçš„ç‰›å•¤ã€‚è‡ªå·± <code>docker rm</code> å† <code>docker run</code> ä¸€æ¬¡å§ã€‚çœŸæœºéƒ¨ç½² jaeger è¿˜æ²¡è§è¿‡ç›´æ¥ç•¥ï¼Œæ— éæ˜¯æ”¹ systemd é…ç½®æˆ–è€… /etc/init.d ã€‚</p>
<p>åˆ°è¿™é‡Œ jaeger éƒ¨ç½²çš„è°ƒæ•´å°±å®Œäº†ï¼Œä½†é—®é¢˜è¿˜æ²¡è§£å†³ï¼šè¦æ˜¯æ—¶é—´ä¹…äº†ï¼Œä¼šä¸ä¼šè¿˜åˆ›å»ºä¸€å † indicesï¼Ÿæ®æˆ‘è§‚å¯Ÿï¼Œåº”è¯¥ä¸ä¼šå†æ¯å¤© 2 ä¸ª index çš„é¢‘ç‡é«˜å¼ºåº¦åˆ›å»º index äº†ï¼ˆPSï¼šå› ä¸ºç¬¬ä¸€å¤©åŠ¨æ‰‹çš„æ—¶å€™æ²¡æ³¨æ„ï¼Œjaeger æ²¡åŠ  <code>--es.use-aliases=true</code>ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿä¸æ•¢è¯´ç»å¯¹ä¸ä¼šï¼Œå»ºè®®è‡ªå·±æ”¹äº†ç¬¬äºŒå¤©çœ‹ä¸€çœ¼ã€‚ï¼‰ï¼Œæ–°çš„ index ä¼šå†™å…¥åˆ°ä¹‹å‰çœ‹åˆ°çš„ <code>jaeger-span-000001</code> è¿™ç§ index é‡Œã€‚</p>
<p>æ–‡æ¡£é‡Œç»™äº†ä¸ªä»æ¯æ—¥åˆ›å»ºç´¢å¼•è½¬åˆ° rollover çš„è¿ç§»æ–¹æ³•ï¼š</p>
<p><strong>è¿™ä¸ä¼šåˆ é™¤æ—§ç´¢å¼•ï¼Œåªæ˜¯æŠŠæ—§ç´¢å¼•åˆå¹¶åˆ°äº†åˆ«å<code>jaeger-*-read</code>é‡Œï¼Œè®© jaeger èƒ½æŸ¥è¯¢åˆ°æ—§çš„æ—¥å¿—ã€‚</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>curl -ivX POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> localhost:9200/_aliases -d <span class=s1>&#39;{&#34;actions&#34; : [{ &#34;add&#34; : { &#34;index&#34; : &#34;jaeger-span-*-*-*&#34;, &#34;alias&#34; : &#34;jaeger-span-read&#34; } }, { &#34;add&#34; : { &#34;index&#34;:&#34;jaeger-service-*-*-*&#34;, &#34;alias&#34; : &#34;jaeger-service-read&#34; }}]}&#39;</span>
<span class=c1># archive indices</span>
curl -ivX POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> localhost:9200/_aliases -d <span class=s1>&#39;{&#34;actions&#34; : [{ &#34;add&#34; : { &#34;index&#34; : &#34;jaeger-span-archive&#34;, &#34;alias&#34; : &#34;jaeger-span-archive-read&#34; } }]}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„å¦‚æœæœ‰å½’æ¡£çš„è¯ç”¨ ç¬¬äºŒæ¡ curl çš„åŒæ—¶è¿˜è¦ç»™ <code>jaeger</code> åŠ ä¸Šå¯åŠ¨å‚æ•°<code>--es.archive.use-aliases=true</code>ã€‚</p>
<h4 id=è½®è½¬>è½®è½¬</h4>
<p>åˆ°è¿™é‡Œï¼Œé—®é¢˜è§£å†³äº†90%ï¼Œä½†è¿˜æœ‰ä¸ªé—®é¢˜ï¼šå¦‚æœæ‰€æœ‰ jaeger æ•°æ®éƒ½æ”¾åœ¨ä¸€ä¸ª index é‡Œï¼Œè¿‡ä¸Šä¸€æ®µæ—¶é—´ï¼Œæ•°æ®é‡è†¨èƒ€åä¼šä¸ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ï¼Ÿè¿™æ˜¯å¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œæ—¥å¿—è¿™ç§ä¸œè¥¿æ˜¯å¾ˆå®¹æ˜“è†¨èƒ€çš„ï¼Œéšæ—¶é—´æµé€å¾ˆå¯èƒ½å †æˆä¸€åº§éš¾ä»¥æ¸…ç†çš„å¤§å±±ï¼šå°±åƒæ˜¯ä½ æƒ³åœ¨MySQLé‡Œå¾€ä¸€ä¸ªè®°å½•è¶…äº¿çº§çš„è¡¨é‡Œæ’æ•°æ®æˆ–åˆ æ•°æ®ä¸€æ ·ã€‚</p>
<p><code>jaeger-es-rollover</code> çœŸæ­£çš„ç”¨é€”å°±æ˜¯è¿™ä¸ªï¼šè½®è½¬æ—¥å¿—ã€‚ä¸€ä¸ª index å·²ç»æœ‰ 100M äº†ï¼Œé‚£å°±æ¢ä¸€ä¸ª index å§ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># æŒ‰ CONDITIONS æŒ‡å®šçš„è§„åˆ™è½®è½¬</span>
docker run -it --rm --net<span class=o>=</span>host -e <span class=nv>CONDITIONS</span><span class=o>=</span><span class=s1>&#39;{&#34;max_age&#34;: &#34;1s&#34;}&#39;</span> jaegertracing/jaeger-es-rollover:latest rollover  http://localhost:9200
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Rollover lets you configure when to roll over to a new index based on one or more of the following criteria:</p>
<ul>
<li><code>max_age</code> - the maximum age of the index. It uses <a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/master/common-options.html#time-units target=_blank rel=noopener>time units</a>: <code>d</code>, <code>h</code>, <code>m</code>.</li>
<li><code>max_docs</code> - the maximum documents in the index.</li>
<li><code>max_size</code> - the maximum estimated size of primary shards (since Elasticsearch 6.x). It uses <a class=link href=https://www.elastic.co/guide/en/elasticsearch/reference/master/common-options.html#byte-units target=_blank rel=noopener>byte size units</a> <code>tb</code>, <code>gb</code>, <code>mb</code>.</li>
</ul>
</blockquote>
<p>ç›®å‰æ”¯æŒçš„æ¡ä»¶å°±åªæœ‰è¿™äº›ã€‚rollover å¹¶ä¸èƒ½è®© es <em>æ›¿ä½ </em> è½®è½¬ç´¢å¼•ï¼Œæ‰€ä»¥è¿™ä¸ª rollover å‘½ä»¤åªèƒ½è‡ªå·±å®šæ—¶æ‰§è¡Œã€‚</p>
<p>å¯¹äº docker-compose ç”¨æˆ·æˆ–è€… docker ç”¨æˆ·æˆ‘æ²¡å•¥å¥½åŠæ³•ï¼Œä¹Ÿè®¸ä½ å¯ä»¥åœ¨å®¿ä¸»æœºé‡Œå†™ä¸€ä¸ª crontab è·‘ä¸Šé¢çš„<code>docker run</code>ã€‚</p>
<p>å¯¹äºæˆ‘è¿™æ ·çš„ kubernetes ç”¨æˆ·åˆ™å¯ä»¥é€‰æ‹©ç”¨ kubernetes çš„ cronjob å®ç°ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1beta1</span><span class=w> </span><span class=c># å¯¹äº kubernetes v1.21.x å·²ç»ä¸æ˜¯ beta äº†ï¼Œæ”¹æˆ batch/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>CronJob</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>jaeger-es-index-rollover</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>jaeger</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0 0 * * 0&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>jobTemplate</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=c># see document https://www.jaegertracing.io/docs/1.32/deployment/#remove-old-data</span><span class=w>
</span><span class=w>          </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>jaegertracing/jaeger-es-rollover:latest</span><span class=w>
</span><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>jaeger-es-rollover</span><span class=w>
</span><span class=w>            </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CONDITIONS</span><span class=w>
</span><span class=w>                </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{&#34;max_age&#34;:&#34;2d&#34;}&#39;</span><span class=w>
</span><span class=w>            </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- <span class=l>rollover</span><span class=w>
</span><span class=w>              </span>- --<span class=l>es.username=***censored***</span><span class=w>
</span><span class=w>              </span>- --<span class=l>es.password=***censored***</span><span class=w>
</span><span class=w>              </span>- <span class=s2>&#34;http://elasticsearch-es-http.elasticsearch.svc.cluster.local:9200&#34;</span><span class=w>
</span><span class=w>            </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>              </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span><span class=w>                </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span><span class=w>                </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>100Mi</span><span class=w>
</span><span class=w>              </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span><span class=w>                </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span><span class=w>                </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>100Mi</span><span class=w>
</span><span class=w>          </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>å¥½ï¼Œé—®é¢˜è§£å†³99%äº†ï¼</p>
<h4 id=åˆ é™¤>åˆ é™¤</h4>
<p>æœ€åå°±æ˜¯åˆ é™¤ä¸å†éœ€è¦çš„æ•°æ®äº†ï¼Œå¾ˆç®€å•å•¦ã€‚ä¸‹é¢çš„å‘½ä»¤ä¸­ <code>14</code> è¡¨ç¤ºä¿ç•™æœ€è¿‘14å¤©çš„æ—¥å¿—ï¼ŒåŒæ ·æ”¯æŒ <code>--es.username</code>å’Œ<code>--es.password</code>å‚æ•°ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>docker run -it --rm --net<span class=o>=</span>host -e <span class=nv>ROLLOVER</span><span class=o>=</span><span class=nb>true</span> jaegertracing/jaeger-es-index-cleaner:latest <span class=m>14</span> http://localhost:9200
</code></pre></td></tr></table>
</div>
</div><p><strong>æ³¨æ„ï¼Œè™½ç„¶æ–‡æ¡£è¯´ <em>that is also used for daily indices</em>ï¼Œä½†å®é™…å‘ç°å¥½åƒå¹¶ä¸ä¼šåˆ ã€‚</strong></p>
<p>æˆ‘ä¸ç¡®å®šæ˜¯ä¸æ˜¯ <strong>ROLLOVER</strong> è¿™ä¸ªç¯å¢ƒå˜é‡çš„å½±å“ï¼Œå»ºè®®è‡ªå·±è¯•è¯•ã€‚</p>
<h3 id=elasticsearch-curator>elasticsearch-curator</h3>
<p>å¥½äº†ï¼Œå¥‡æŠ€æ·«å·§ç¯èŠ‚ã€‚<a class=link href=https://github.com/elastic/curator target=_blank rel=noopener>curator</a> æ˜¯ä¸€ä¸ª elastic å…¬å¸å¼€æºçš„ python åŒ…ï¼Œä»‹ç»æ¯”è¾ƒçš®ï¼š</p>
<blockquote>
<p>Have indices in Elasticsearch? This is the tool for you!</p>
<p>Like a museum curator manages the exhibits and collections on display, Elasticsearch Curator helps you curate, or manage your indices.</p>
</blockquote>
<p>å¯¹ä¸èµ·ï¼Œæ²¡å»è¿‡åšç‰©é¦†ï¼Œä¹Ÿæ²¡åšè¿‡é¦†é•¿ï¼ŒGet ä¸åˆ°ã€‚</p>
<p>ç®€å•åœ°è¯´ï¼Œcurator æ˜¯ä¸€ä¸ª indice ç®¡ç†çš„å·¥å…·ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·å®ç°æ‰¾åˆ°æ—§ç´¢å¼•å¹¶åˆ é™¤ã€‚</p>
<p>curator çš„å‘½ä»¤è¡Œç•Œé¢åƒè¿™æ ·ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext>Usage: curator [OPTIONS] ACTION_FILE

  Curator for Elasticsearch indices.

  See http://elastic.co/guide/en/elasticsearch/client/curator/current

Options:
  --config PATH  Path to configuration file. Default: ~/.curator/curator.yml
  --dry-run      Do not perform any changes.
  --version      Show the version and exit.
  --help         Show this message and exit.
</code></pre></td></tr></table>
</div>
</div><p>å…³äºè¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å®˜æ–¹æ–‡æ¡£é‡Œçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š<a class=link href=https://www.elastic.co/guide/en/elasticsearch/client/curator/current/configfile.html target=_blank rel=noopener>configuration file</a> å’Œ <a class=link href=https://www.elastic.co/guide/en/elasticsearch/client/curator/current/actionfile.html target=_blank rel=noopener>action file</a>ã€‚</p>
<p>configuration file ä¿å­˜çš„æ˜¯å…³äºè¿æ¥ es æ‰€éœ€çš„é…ç½®å¦‚åœ°å€ã€ç”¨æˆ·åå¯†ç ã€éªŒè¯æ–¹æ³•ç­‰ï¼Œä»¥åŠå·¥å…·æœ¬èº«çš„é…ç½®å¦‚æ—¥å¿—ã€‚</p>
<p>action file ä¿å­˜çš„æ˜¯æˆ‘ä»¬å¸Œæœ› curator å¸®æˆ‘ä»¬å®Œæˆçš„æ“ä½œã€‚</p>
<p>action file çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>actions</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>1</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>ACTION1</span><span class=w>
</span><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>OPTIONAL DESCRIPTION</span><span class=w>
</span><span class=w>    </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>option1</span><span class=p>:</span><span class=w> </span><span class=l>value1</span><span class=w>
</span><span class=w>      </span><span class=l>...</span><span class=w>
</span><span class=w>    </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>filtertype</span><span class=p>:</span><span class=w> </span><span class=cp>*first*</span><span class=w>
</span><span class=w>      </span><span class=nt>filter_element1</span><span class=p>:</span><span class=w> </span><span class=l>value1</span><span class=w>
</span><span class=w>      </span><span class=l>...</span><span class=w>
</span><span class=w>  </span><span class=nt>2</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=l>...</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ <code>action</code> æ˜¯æˆ‘ä»¬å¸Œæœ› curator åšçš„äº‹ï¼Œ<code>options</code> å’Œ <code>filters</code> æ§åˆ¶ <code>action</code> çš„è¡Œä¸ºå’Œè¡Œä¸ºçš„å¯¹è±¡ã€‚<code>action</code>æ”¯æŒ<a class=link href=https://www.elastic.co/guide/en/elasticsearch/client/curator/current/actions.html target=_blank rel=noopener>å¾ˆå¤šä¸åŒçš„æ“ä½œ</a>ã€‚</p>
<p>å¥½äº†ï¼Œç°åœ¨çœ‹å®ä¾‹ã€‚æˆ‘ä»¬æƒ³åˆ é™¤åç§°ç¬¦åˆ <code>jaeger-span-yyyy-mm-dd</code> æ ¼å¼çš„ indexï¼Œå¹¶ä¸”<code>yyyy-mm-dd</code>å°äºæŒ‡å®šçš„æ—¥æœŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>1</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete_indices</span><span class=w>
</span><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span><span class=sd>          </span><span class=w>          </span><span class=l>delete old jaeger-span indices</span><span class=w>
</span><span class=w>        </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>ignore_empty_list</span><span class=p>:</span><span class=w> </span><span class=kc>True</span><span class=w>
</span><span class=w>          </span><span class=nt>timeout_override</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>continue_if_exception</span><span class=p>:</span><span class=w> </span><span class=kc>True</span><span class=w>
</span><span class=w>          </span><span class=nt>disable_action</span><span class=p>:</span><span class=w> </span><span class=kc>False</span><span class=w>
</span><span class=w>        </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=nt>filtertype</span><span class=p>:</span><span class=w> </span><span class=l>pattern</span><span class=w>
</span><span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>prefix</span><span class=w>
</span><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>jaeger-span</span><span class=w>
</span><span class=w>            </span><span class=nt>exclude</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=nt>filtertype</span><span class=p>:</span><span class=w> </span><span class=l>age</span><span class=w>
</span><span class=w>            </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=l>name</span><span class=w>
</span><span class=w>            </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class=l>older</span><span class=w>
</span><span class=w>            </span><span class=nt>timestring</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;%Y-%m-%d&#39;</span><span class=w>
</span><span class=w>            </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=l>days</span><span class=w>
</span><span class=w>            </span><span class=nt>unit_count</span><span class=p>:</span><span class=w> </span><span class=m>7</span><span class=w>
</span><span class=w>            </span><span class=nt>exclude</span><span class=p>:</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>åŠ¨ä½œï¼š<code>delete_indices</code>ï¼›å¿½ç•¥ç©ºè¾“å…¥ï¼Œå³ä½¿å¼‚å¸¸ä¹Ÿç»§ç»­æ‰§è¡Œï¼›è¦åˆ é™¤çš„å¯¹è±¡ä»¥ <code>jaeger-span</code> å¼€å¤´ï¼Œå¹¶ä¸”åç§°åŒ…å« <code>%Y-%m-%d</code> æ¨¡å¼çš„æ—¥æœŸï¼Œä¸”æ—©äº 7 å¤©å‰ã€‚</p>
<p>doneï¼æŠŠä¸Šé¢çš„é…ç½®å¤åˆ¶ä¸€ä»½å¥—ç”¨åˆ° <code>jaeger-service-yyyy-mm-dd</code> ä¸Šï¼Œåˆ é™¤ jaeger-span çš„ä»»åŠ¡å°±ç®—é…ç½®å¥½äº†ã€‚</p>
<p>æ¥ä¸‹æ¥æŠŠåˆ é™¤å·¥ä½œé…ç½®æˆå®šæ—¶ä»»åŠ¡ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨äº† cronjobã€‚</p>
<p>å…ˆæŠŠé…ç½®ä¿å­˜æˆ ConfigMapã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=c># https://kubernetes.io/docs/concepts/configuration/configmap/</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>curator-config</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>jaeger</span><span class=w>
</span><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>curator.yml</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>    client:
</span><span class=sd>      hosts:
</span><span class=sd>        - ****
</span><span class=sd>        - ****
</span><span class=sd>        - ****
</span><span class=sd>      port: 9200
</span><span class=sd>      username: ***censored***
</span><span class=sd>      password: ***censored***
</span><span class=sd>    logging:
</span><span class=sd>      loglevel: INFO
</span><span class=sd>      logformat: default</span><span class=w>    
</span><span class=w>  </span><span class=nt>action.yml</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>    actions:
</span><span class=sd>      1:
</span><span class=sd>        action: delete_indices
</span><span class=sd>        description: &gt;-
</span><span class=sd>          delete old jaeger-span indices
</span><span class=sd>        options:
</span><span class=sd>          ignore_empty_list: True
</span><span class=sd>          timeout_override:
</span><span class=sd>          continue_if_exception: True
</span><span class=sd>          disable_action: False
</span><span class=sd>        filters:
</span><span class=sd>          - filtertype: pattern
</span><span class=sd>            kind: prefix
</span><span class=sd>            value: jaeger-span
</span><span class=sd>            exclude:
</span><span class=sd>          - filtertype: age
</span><span class=sd>            source: name
</span><span class=sd>            direction: older
</span><span class=sd>            timestring: &#39;%Y-%m-%d&#39;
</span><span class=sd>            unit: days
</span><span class=sd>            unit_count: 7
</span><span class=sd>            exclude:
</span><span class=sd>      2:
</span><span class=sd>        action: delete_indices
</span><span class=sd>        description: &gt;-
</span><span class=sd>          delete old jaeger-service indices
</span><span class=sd>        options:
</span><span class=sd>          ignore_empty_list: True
</span><span class=sd>          timeout_override:
</span><span class=sd>          continue_if_exception: True
</span><span class=sd>          disable_action: False
</span><span class=sd>        filters:
</span><span class=sd>          - filtertype: pattern
</span><span class=sd>            kind: prefix
</span><span class=sd>            value: jaeger-service
</span><span class=sd>            exclude:
</span><span class=sd>          - filtertype: age
</span><span class=sd>            source: name
</span><span class=sd>            direction: older
</span><span class=sd>            timestring: &#39;%Y-%m-%d&#39;
</span><span class=sd>            unit: days
</span><span class=sd>            unit_count: 7
</span><span class=sd>            exclude:</span><span class=w>    
</span></code></pre></td></tr></table>
</div>
</div><p>å†ç¼–å†™ä¸€ä¸ª CronJob</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1beta1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>CronJob</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>jaeger-es-index-cleanup</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>jaeger</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0 0 * * 0&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>jobTemplate</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>curator-config</span><span class=w>
</span><span class=w>                </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span><span class=w>                  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>curator-config</span><span class=w>
</span><span class=w>            </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>bitnami/elasticsearch-curator:5.8.4</span><span class=w>
</span><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-curator</span><span class=w>
</span><span class=w>              </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>                </span>- <span class=l>sh</span><span class=w>
</span><span class=w>                </span>- -<span class=l>c</span><span class=w>
</span><span class=w>                </span>- <span class=l>curator --config /cfg/curator.yml /cfg/action.yml</span><span class=w>
</span><span class=w>              </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>                </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/cfg</span><span class=w>
</span><span class=w>                  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>curator-config</span><span class=w>
</span><span class=w>              </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>                </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span><span class=w>                  </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span><span class=w>                  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>100Mi</span><span class=w>
</span><span class=w>                </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span><span class=w>                  </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span><span class=w>                  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>100Mi</span><span class=w>
</span><span class=w>            </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œç”¨äº† <code>bitnami/elasticsearch-curator</code> é•œåƒï¼Œå¦‚æœä¸ä¿¡ä»»çš„è¯å¯ä»¥è‡ªå·±å†™ä¸ª Dockerfile ä¹Ÿä¸ä¼šå¾ˆéº»çƒ¦ã€‚æˆ‘ä¸»è¦çœ‹ä¸­ bitnami é•œåƒå¤§å°ä¼˜åŒ–è¿˜ä¸é”™ï¼ˆ98Mï¼‰ï¼Œè¦æ˜¯æˆ‘è‡ªå·±éšä¾¿å†™ä¸€ä¸ªçš„è¯å¯èƒ½å°±ä¸æ­¢è¿™ä¹ˆå¤§äº†ã€‚çœ‹äº†çœ¼é•œåƒçš„ Dockerfile æ²¡æœ‰ä»€ä¹ˆå¯ç–‘çš„åœ°æ–¹å°±ç›´æ¥ç”¨å•¦ã€‚</p>
<p>å¯¹äºéœ€è¦ç«‹åˆ»è·‘ä¸€æ¬¡çš„æƒ…å†µï¼Œå¯ä»¥æŠŠ jobTemplate ä¸‹é¢çš„å†…å®¹å¤åˆ¶å‡ºæ¥å•ç‹¬å†™ä¸ª Job å…ˆè·‘èµ·æ¥ã€‚</p>
<h3 id=æ‰‹åŠ¨>æ‰‹åŠ¨</h3>
<p>æ‰‹åŠ¨æ³•æˆ‘è¯´ä¸ªæ€è·¯ã€‚é¦–å…ˆä½ å¾—æœ‰ä¸ª kibana console å¯ä»¥è®¿é—®ï¼Œæˆ–è€…èƒ½ç›´æ¥è¯·æ±‚åˆ° es çš„ 9200 ç«¯å£ã€‚</p>
<p><code>GET /_cat/indices</code> æ‹¿åˆ° indices åˆ—è¡¨ï¼ŒæŒ‰åå­—æ­£åˆ™è¿‡æ»¤ <code>jaeger-(span|service)-\d{4}-\d{2}-\d{2}</code>ï¼Œç„¶åæŠŠåé¢çš„æ—¥æœŸè§£æä¸€ä¸‹ï¼›æˆ–è€…ç²—æš´ç‚¹ï¼Œç›´æ¥<code>^(2022-04-\d{2})</code>è¿‡æ»¤å‡ºæœ¬æœˆï¼ˆ4æœˆï¼‰ä»¥å¤–çš„æ‰€æœ‰ç´¢å¼•ï¼Œæ‹¿åˆ°ä¸€ä¸ªç´¢å¼•åˆ—è¡¨ã€‚</p>
<p>å…·ä½“ç‚¹è¯´ï¼Œåƒæ˜¯ kibana console æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªæ¯è¡Œæ ¼å¼å¦‚ <code>green open jaeger-span-2022-03-01 ....</code> è¿™æ ·çš„çº¯æ–‡æœ¬ï¼Œä½ å¯ä»¥æ”¾åˆ° vscode é‡Œç„¶åç”¨ <code>Filter Lines</code> è¿™æ ·çš„æ’ä»¶å¿«é€Ÿæ­£åˆ™è¿‡æ»¤å‡ºæ¥ï¼Œå†æŒ‰ <code>alt+shift+æ–¹å‘é”®</code> å¤šå…‰æ ‡ï¼Œå¿«é€Ÿç¼–è¾‘å‡ºä¸€ä¸ªç´¢å¼•åç§°åˆ—è¡¨ã€‚</p>
<p><img src=/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413154700392.png width=1338 height=315 srcset="/blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413154700392_huedcedc0cd6515fa937cef755447c928f_26312_480x0_resize_box_3.png 480w, /blog/p/jaeger-with-es-backend-exceeded-maximum-shards-open/image-20220413154700392_huedcedc0cd6515fa937cef755447c928f_26312_1024x0_resize_box_3.png 1024w" loading=lazy alt=kibana class=gallery-image data-flex-grow=424 data-flex-basis=1019px></p>
<p>ç„¶åæŠŠç´¢å¼•åå‰é¢åŠ ä¸Š <code>DELETE /</code>ï¼Œäº§ç”Ÿ <code>DELETE /jaeger-span-2022-03-01</code> è¿™æ ·çš„åˆ—è¡¨ï¼Œè´´åˆ° kibana console é‡Œï¼Œå…¨é€‰è¿è¡Œï¼Œdoneã€‚</p>
<p>è¦æ˜¯æ²¡ kibana ï¼Œåªæœ‰ 9200 è®¿é—®ï¼Œå°±æ”¹æˆ curl è¯·æ±‚ï¼Œæˆ–è€… httpie ï¼Œåæ­£æ€»æœ‰åŠæ³•ã€‚æœ€åæ‰¹é‡æ‰§è¡Œå°±å¥½ã€‚</p>
<p>è¦æ˜¯éƒ½æ²¡æœ‰ï¼Œè®²é“ç†å•Šä½ è·Ÿè´Ÿè´£äººè¯´ä¸‹è¦ä¸ªè®¿é—®æƒé™å¥½å§&mldr;&mldr;</p>
<p>è¦æ˜¯å¯¹è‡ªå·±çš„è„šæœ¬ç¼–ç¨‹èƒ½åŠ›æœ‰è‡ªä¿¡çš„è¯ï¼Œå¤§å¯ç›´æ¥å†™ä¸ª bash è„šæœ¬å®šæ—¶è·‘ï¼Œä¹Ÿæ˜¯ ok çš„ã€‚</p>
<h2 id=æ€»ç»“>æ€»ç»“</h2>
<p>æ€»ä¹‹ï¼Œ<code>jaeger-es-rollover</code> é… <code>jaeger-es-index-cleaner</code>ï¼›æˆ–è€…<code>elasticsearch-curator</code>éƒ½è¡Œã€‚æ‰‹åŠ¨æ³•æ— éæ˜¯æ‰‹å·¥æ‹¿åˆ° indices ç„¶åç”¨å„ç§ç¼–è¾‘å™¨æ‰¹é‡ç¼–è¾‘æŠ€å·§æˆ–è€…æ­£åˆ™æ›¿æ¢ï¼Œæ‹¼å‡ºä¸ªè„šæœ¬ã€‚æ­£åˆ™è¡¨è¾¾å¼å½“çœŸæ˜¯æ¯ä¸ªå¼€å‘è€…çš„å¿…å¤‡è‰¯è¯ã€‚</p>
<p>è®²é“ç†åœ°è¯´è¦ä¸æ˜¯ jaeger ç»™æˆ‘æ•´è¿™ä¸€å‡ºæˆ‘å¯èƒ½è¿˜æƒ³ä¸åˆ°æ‹¿ es å½“ jaeger åç«¯è¿˜ä¼šæœ‰è¿™ç§å‘ã€‚ä½†è¿™ä¹Ÿç®—ç»™æˆ‘æäº†ä¸ªé†’ï¼ŒæŒ‚åœ¨ es ä¸Šçš„æ•°æ®è™½ç„¶ä¸å¤šè€Œä¸”éƒ½æ˜¯ä» MySQL åŒæ­¥è¿‡å»çš„ï¼Œes çš„ä¸€äº›åŸºæœ¬é…ç½®å¦‚åˆ†ç‰‡å•¥çš„è¿˜æ˜¯å¾—å…³æ³¨ä¸€ä¸‹ï¼Œä¸èƒ½åªé¡¾ç€æ¥ apiã€‚è¿™å°±æ˜¯æ‰€è°“çš„ <em>è¿ç»´å‹åŠ›</em> äº†å§ã€‚</p>
<p>åº”è¯¥è¿˜æœ‰ä¸å°‘å°å…¬å¸çš„å¼€å‘å…¶å®æ˜¯ç¼ºä¹èƒ½åŠ›è¿ç»´è¯¸å¦‚ es è¿™æ ·çš„é¡¹ç›®çš„ï¼Œå¯¹ MySQL ä¹Ÿæ˜¯ä»…é™äºç²¾é€š <strong>å®‰è£…å’Œä½¿ç”¨</strong> ï¼Œä½†é—®èµ·æ€ä¹ˆæ€ä¹ˆé«˜å¯ç”¨ï¼Œæ€ä¹ˆåšä¸»å¤‡ï¼Œæ€ä¹ˆåšè¯»å†™åˆ†ç¦»ï¼Œæ€ä¹ˆåˆ†åº“åˆ†è¡¨ï¼Œå…¶å®ä¸€ä¸ªä¹Ÿä¸ä¼šï¼ˆå¯¹ï¼Œæˆ‘ä¹Ÿå·®ä¸å¤šï¼‰ã€‚</p>
<p>k8s ä¹Ÿæ˜¯ä¸ªå¾ˆå¤§çš„å‘ï¼Œç°åœ¨ç”šè‡³æœ‰ç‚¹æ„Ÿè§‰åç«¯ä¸€è·¯èµ°ä¸‹æ¥çœŸæ­£å‘äººçš„éƒ½æ˜¯è¿™äº›å¤§æ¡†æ¶ï¼Œå¤§æ¦‚å¿µï¼Œæ¯”å¦‚å‰æ®µæ—¶é—´æµè¡Œè¿‡çš„<strong>ä¸­å°</strong>ï¼Œé£å£ä¸Šçš„<strong>äº‘è®¡ç®—</strong>ã€<strong>äº‘åŸç”Ÿ</strong>ï¼Œå¥½åƒæ²¾ä¸ª<strong>äº‘</strong>å°±ç‰›é€¼èµ·æ¥äº†ã€‚æˆ‘ä¸æ˜¯è¯´ k8s æ²¡ç”¨å—·ï¼Œæˆ‘æ˜¯è¯´åª’ä½“å¹çš„æ—¶å€™ä¸ªä¸ªéƒ½æ˜¯é“¶å¼¹ï¼Œè€æ¿å¹çš„æ—¶å€™å„ä¸ªéƒ½æ˜¯<strong>ç»™æˆ‘ä¹Ÿæ•´ä¸€ä¸ªï¼</strong></p>
<p>è¿˜å¥½å‹åŠ›æœ€åéƒ½è½¬åŒ–æˆäº†è§é¬¼çš„éœ€æ±‚å’Œè«åå…¶å¦™çš„æŠ€æœ¯é€‰å‹ï¼Œæœ€åº•å±‚çš„å¼€å‘åªè¦æ”¾å¼ƒæ€è€ƒå°±å®Œäº‹äº†ï¼Œå†™ä»€ä¹ˆä»£ç ä¸æ˜¯å†™ï¼Œå¤§å®¶éƒ½æ˜¯ç»™èµ„æœ¬æœåŠ¡å˜›ã€‚</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/blog/tags/elasticsearch/>elasticsearch</a>
<a href=/blog/tags/kubernetes/>kubernetes</a>
<a href=/blog/tags/jaeger/>jaeger</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>ç›¸å…³æ–‡ç« </h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/blog/p/simple-eck-cluster-deployment/>
<div class=article-details>
<h2 class=article-title>ç®€å•çš„ECKéƒ¨ç½²</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<link rel=stylesheet href=https://unpkg.com/vssue/dist/vssue.min.css>
<div id=vssue></div>
<script src=https://unpkg.com/vue@2.6.14/dist/vue.runtime.min.js></script>
<script src=https://unpkg.com/vssue@1.4.8/dist/vssue.github.min.js></script>
<script>new Vue({el:"#vssue",render:a=>a("Vssue",{props:{title:"è®°ä¸€æ¬¡ jaeger es åç«¯å‡ºç° maximum shards open é”™è¯¯æ’æŸ¥",options:{autoCreateIssue:!1,owner:"nnnewb",repo:"blog",clientId:"285910fdc1567a1a23e3",clientSecret:"f00da5438d9ac82c4a86024866c7a916ae411edc"}}})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2022 weakptr's ç¬”è®°
</section>
<section class=powerby>
GitHub Pages <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡
ï¼Œç”± <a href=https://nnnewb.github.io/blog/>nnnewb</a> ä¿®æ”¹
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">ç›®å½•</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#å‰è¨€>å‰è¨€</a></li>
<li><a href=#åŸå› >åŸå› </a>
<ol>
<li><a href=#jaegeräº§ç”Ÿå¤§é‡åˆ†ç‰‡>jaegeräº§ç”Ÿå¤§é‡åˆ†ç‰‡</a></li>
<li><a href=#esæ¯ä¸ªèŠ‚ç‚¹åˆ†ç‰‡æ•°é‡å—é™>esæ¯ä¸ªèŠ‚ç‚¹åˆ†ç‰‡æ•°é‡å—é™</a></li>
</ol>
</li>
<li><a href=#å¤„ç†>å¤„ç†</a>
<ol>
<li><a href=#jaeger-es-rollover>jaeger-es-rollover</a>
<ol>
<li><a href=#åˆå§‹åŒ–>åˆå§‹åŒ–</a></li>
<li><a href=#è½®è½¬>è½®è½¬</a></li>
<li><a href=#åˆ é™¤>åˆ é™¤</a></li>
</ol>
</li>
<li><a href=#elasticsearch-curator>elasticsearch-curator</a></li>
<li><a href=#æ‰‹åŠ¨>æ‰‹åŠ¨</a></li>
</ol>
</li>
<li><a href=#æ€»ç»“>æ€»ç»“</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>